<!-- iwm20210822B Ver.20211117 'U-2S' -->

<!DOCTYPE html>
<html lang="ja">

<head>
<meta charset="UTF-8"/>
<meta http-equiv="Content-Script-Type" content="text/javascript"/>
<title>地理院タイル・簡易ビュアー</title>

<!-- ライブラリ開発諸氏に敬意を表す -->

<!--------------------------------------------------------------------
// leaflet
// https://leafletjs.com/
--------------------------------------------------------------------->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A==" crossorigin=""/>
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js" integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA==" crossorigin=""></script>

<!--------------------------------------------------------------------
// Leaflet.MiniMap
// https://github.com/Norkart/Leaflet-MiniMap
--------------------------------------------------------------------->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-minimap/3.6.1/Control.MiniMap.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-minimap/3.6.1/Control.MiniMap.js"></script>

<!--------------------------------------------------------------------
// leaflet.awesome-markers
// https://github.com/lvoogdt/Leaflet.awesome-markers
--------------------------------------------------------------------->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.min.js"></script>

<!--------------------------------------------------------------------
// fork-awesome
// https://forkaweso.me/Fork-Awesome/
--------------------------------------------------------------------->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fork-awesome@1.1.7/css/fork-awesome.min.css" integrity="sha256-gsmEoJAws/Kd3CjuOQzLie5Q3yshhvmo7YNtBG7aaEY=" crossorigin="anonymous"/>

<!--------------------------------------------------------------------
// Leaflet.PolylineMeasure
// https://github.com/ppete2/Leaflet.PolylineMeasure
--------------------------------------------------------------------->
<link rel="stylesheet" href="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.css"/>
<script src="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js"></script>

<!--------------------------------------------------------------------
// Leaflet.greatCircle
// https://github.com/nuclearsecrecy/Leaflet.greatCircle
--------------------------------------------------------------------->
<script src="https://nuclearsecrecy.github.io/Leaflet.greatCircle/Leaflet.greatCircle.js"></script>

<!--------------------------------------------------------------------
// Leaflet.Graticule
// https://github.com/turban/Leaflet.Graticule
--------------------------------------------------------------------->
<script type="text/javascript" src="https://leaflet.github.io/Leaflet.Graticule/Leaflet.Graticule.js"></script>

<!--------------------------------------------------------------------
// Leaflet.Heightgraph
// https://github.com/GIScience/Leaflet.Heightgraph
--------------------------------------------------------------------->
<link rel="stylesheet" href="https://giscience.github.io/Leaflet.Heightgraph/dist/L.Control.Heightgraph.min.css"/>
<script type="text/javascript" src="https://giscience.github.io/Leaflet.Heightgraph/dist/L.Control.Heightgraph.min.js"></script>

<!--------------------------------------------------------------------
// CSS
--------------------------------------------------------------------->
<style>
@charset "utf-8";

/*-------
// 共通
-------*/
*
{
	font-family:sans-serif;
	margin:0;
	padding:0;
}
/*------------------
// leaflet CSS置換
------------------*/
.leaflet-popup-content-wrapper,
.leaflet-popup-tip
{
	background:#fff;
	border-color:#333;
	-webkit-border-radius:3px !important;
	-moz-border-radius:3px !important;
	border-radius:3px !important;
}
.leaflet-popup-content,
.leaflet-popup-close-button
{
	color:#333 !important;
	font-size:11px;
	line-height:14px;
	margin:0;
	padding:2px 5px;
}
.leaflet-container
{
	background:#fff;
}
#map
{
	position:absolute;
	top:0;
	left:0;
	width:100%;
	height:100%;
	margin:0;
	padding:0;
}
/*-------------------
// 本スクリプト関係
-------------------*/
body
{
	background:#f6f6f7;
	margin:0;
	padding:0;
}
input[type="file"]
{
	color:#000;
	margin:0;
	padding:0;
}
._btnNavi1,
._btnNavi2,
._btnNavi3,
._btnNavi4,
._btnNavi5
{
	border:0;
	color:#fff;
	font-size:12px;
	line-height:18px; /* WebKitの余白に対応するため以下18pxで統一 */
	margin:0;
	padding:0 8px;
	text-decoration:none;
	vertical-align:middle;
}
._btnNavi1:hover,
._btnNavi2:hover,
._btnNavi3:hover,
._btnNavi4:hover,
._btnNavi5:hover
{
	cursor:pointer;
}
._btnNavi1
{
	background:#3d7cce;
}
._btnNavi1:hover
{
	background:#6dacff;
}
._btnNavi2
{
	background:#bd1e38;
}
._btnNavi2:hover
{
	background:#ed4e68;
}
._btnNavi3
{
	background:#2dae6c;
}
._btnNavi3:hover
{
	background:#3dce7c;
}
._btnNavi4
{
	background:#855896;
}
._btnNavi4:hover
{
	background:#a578a6;
}
._btnNavi5
{
	background:#ffa500;
}
._btnNavi5:hover
{
	background:#ffc520;
}
._txtNavi1,
._txtNavi2
{
	color:#000;
	font-size:12px;
	height:16px;
	margin:0;
	padding:0 3px;
	vertical-align:middle;
}
._txtNavi1
{
	border:1px solid #2dae6c;
}
._txtNavi2
{
	border:1px solid #fa0;
}
._checkboxNavi1
{
	margin:0;
	padding:0;
	vertical-align:middle;
}
/*---------------
// 上部メニュー
---------------*/
#_divNaviCommander
{
	background:#505050;
	border:0;
	border-radius:8px 8px 0 0;
	color:#fff;
	font-size:13px;
	left:0;
	margin:0;
	padding:2px 4px 2px 10px;
	position:absolute;
	top:0;
	/* 動的に変更 */
	width:0;
}
#_divMap
{
	cursor:crosshair;
	left:0;
	position:absolute;
	/* 動的に変更 */
	height:0;
	top:0;
	width:0;
}
#_InputBL,
#_InputZoomA,
#_InputZoomB
{
	background-color:rgba(255, 255, 255, 0.6);
	border:1px solid #777;
	font-size:12px;
	margin:0;
	padding:2px;
	position:absolute;
	z-index:1500;
}
#_InputBL,
#_InputZoomA
{
	top:-1000px; /* フォーマット時に隠すため */
}
#_InputZoomB
{
	/* 以下、必要に応じて修正 */
	left:10px;
	top:34px;
}
/* ↓OverLap */
#_InputBL
{
	width:120px;
}
#_InputZoomA
{
	text-align:center;
	width:150px;
}
#_InputZoomB
{
	border:0;
	margin:0;
	padding:0;
	text-align:center;
}
/* ↑OverLap */
._ZA,
._ZB,
._Btn1,
._Btn2,
._Btn3
{
	border:0;
	color:#fff;
	cursor:pointer;
	font-size:12px;
	margin:2px;
	padding:0;
}
/* ↓OverLap */
._ZA,
._ZB,
._Btn1
{
	background-color:rgba(0, 0, 0, 0.6);
}
._Btn2
{
	background-color:rgba(12, 75, 157, 0.8);
}
._ZA:hover,
._ZB:hover,
._Btn1:hover,
._Btn2:hover
{
	background:#3c7bff !important;
}
._Btn3
{
	background-color:rgba(229, 72, 72, 0.9);
}
._Btn3:hover
{
	background:#ff5858 !important;
}
#_InputBL > ._Btn1,
#_InputBL > ._Btn2,
#_InputBL > ._Btn3
{
	height:23px;
	width:36px;
}
._ZB
{
	margin:0;
}
#_InputZoomA > ._ZA,
#_InputZoomA > ._Btn3,
#_InputZoomB > ._ZB
{
	height:26px;
	width:26px;
}
#_IBL0,
#_IBL1,
#_IBL2
{
	background:#fff;
	border:1px solid #000;
	color:#000;
	cursor:text;
	height:18px;
	ime-mode:inactive;
	line-height:18px;
	margin:1px 2px;
	padding:0 2px;
}
#_IBL0:hover,
#_IBL1:hover,
#_IBL2:hover,
#_IBL0:focus,
#_IBL1:focus,
#_IBL2:focus
{
	background:#ff5;
}
/* ↑OverLap */
#_NaviZoom,
#_NaviLat,
#_NaviLng
{
	border:0;
	font-size:12px;
	height:18px;
	ime-mode:inactive;
	line-height:18px;
	margin:0;
	padding:0 2px;
	vertical-align:middle;
}
#_NaviZoom
{
	width:0;
}
#_NaviLat,
#_NaviLng
{
	width:90px;
}
#_NaviLat:hover,
#_NaviLng:hover,
#_NaviLat:focus,
#_NaviLng:focus
{
	background:#ff5;
}
/*---------------------
// アドレスマッチング
---------------------*/
#_AddMatchInput
{
	background:#fb9d3e;
	border:0;
	line-height:14px;
	margin:0;
	padding:0;
	position:absolute;
	z-index:1000;
	/* 以下、必要に応じて修正 */
	left:45px;
	top:34px;
}
#_AddMatchInput10
{
	background:#fff;
	border:1px solid #fb9d3e;
	color:#000;
	cursor:text;
	font-size:14px;
	height:18px;
	ime-mode:inactive;
	margin:0;
	padding:0 3px;
	vertical-align:middle;
	width:100px;
}
#_AddMatchInput10:hover,
#_AddMatchInput10:focus
{
	background:#ff5;
}
#_AddMatchInput15,
#_AddMatchInput20
{
	border:0;
	color:#fff;
	font-size:15px;
	margin:0;
	padding:0 3px;
	vertical-align:middle;
}
#_AddMatchInput30
{
	border:0;
	color:#fff;
	font-size:15px;
	margin:0;
	padding:0 3px;
	vertical-align:middle;
}
#_AddMatchInput15:hover,
#_AddMatchInput20:hover,
#_AddMatchInput30:hover
{
	color:#f00;
	cursor:pointer;
}
#_AddMatchOutput
{
	background-color:rgba(255, 255, 255, 0.2);
	border:1px solid #fb9d3e;
	color:#000;
	font-size:13px;
	left:0;
	margin:2px 0 0 2px;
	overflow:auto;
	position:absolute;
	top:-1000px; /* フォーマット時に隠すため */
	z-index:1000;
	/* 以下、必要に応じて修正 */
	max-height:480px;
	padding:6px;
	width:220px;
}
#_AddMatchOutput:hover
{
	background:#fff;
}
#_AddMatchOutputH
{
	color:#00d;
	padding:0 0 4px 0;
}
#_AddMatchOutputF
{
	padding:4px 0 0 0;
	text-align:center;
}
#_AddMatchOutput1
{
	color:#000;
	font-size:14px;
	line-height:14px;
	margin:0;
	padding:6px 4px;
}
#_AddMatchOutput1:hover
{
	background:#ff5;
}
._AddMatchRem
{
	color:#f00;
	font-size:11px;
}
/*----------------------
// Leaflet.greatCircle
----------------------*/
#_GCircle
{
	background-color:rgba(0, 0, 0, 0.3);
	color:#fff;
	font-size:8pt;
	height:26px;
	padding:0 0 0 8px;
	position:absolute;
	text-align:left;
	width:200px;
	z-index:500;
}
/*----------------
// Simple Window
----------------*/
._simpleWindowCall
{
	border:solid 1px #fff;
	color:#fff;
	font-size:12px;
	float:right;
	margin:0;
	padding:0 4px;
}
._simpleWindowCall:hover
{
	color:#f00;
	cursor:pointer;
}
._simpleWindow
{
	background-color:rgba(13, 76, 158, 0.8);
	color:#fff;
	float:right;
	font-size:11px;
	line-height:22px;
	margin:0;
	padding:0;
	position:absolute;
	text-align:center;
	z-index:2000;
	/* 以下、必要に応じて修正 */
	right:0;
	top:24px;
}
._simpleWindowTitle
{
	display:; /* ''=表示／'none'=非表示 */
	margin:0;
	padding:0;
}
._simpleWindowClose
{
	color:#f00;
	float:right;
	font-size:18px;
	font-weight:900;
	padding:0 3px 0 0;
}
._simpleWindowClose:hover
{
	color:#fff;
	cursor:pointer;
}
._simpleWindowOutput
{
	background:#f7f7f7;
	border:0;
	color:#000;
	font-size:12px;
	margin:1px;
	overflow:auto;
	padding:0;
	text-align:left;
}
/*---------------
// Edit Textbox
---------------*/
._editTextBox
{
	border:2px solid #fa0;
	color:#000;
	font-size:12px;
	ime-mode:inactive;
	margin:0;
	overflow:auto;
	padding:2px 6px;
	resize:none;
}
._editTextBox:hover,
._editTextBox:focus
{
	background:#ffc;
}
/*--------------------------
// Leaflet.PolylineMeasure
--------------------------*/
.leaflet-control
{
	cursor:pointer;
}
a.polyline-measure-controlOnBgColor,
a.polyline-measure-controlOnBgColor:hover
{
	background-color:rgba(0, 0, 0, 0.7);
	color:#f00;
}
.polyline-measure-unicode-icon
{
	font-size:20px;
	font-weight:bold;
}
a.polyline-measure-clearControl:active
{
	background-color:#f00;
}
.polyline-measure-tooltip
{
	background-color:rgba(0, 0, 0, 0.7);
	border-radius:4px;
	box-shadow:none;
	color:#fff;
	font-size:11px;
	font-style:normal;
	font-weight:normal;
	height:auto !important;
	line-height:10px;
	margin:0;
	padding:1px 4px 2px 4px;
	text-align:left;
	white-space:nowrap;
	width:auto !important;
}
.polyline-measure-tooltip-end
{
	background-color:rgba(0, 0, 0, 0.7);
}
.polyline-measure-tooltip-difference
{
	color:#f00;
	font-size:9px;
	font-style:normal;
	font-weight:normal;
	line-height:9px;
}
.polyline-measure-tooltip-total
{
	color:#fff;
	font-size:11px;
	font-style:normal;
	font-weight:normal;
	line-height:12px;
}
.polyline-measure-popupTooltip
{
	background:#000;
	color:#fff;
	font-size:12px;
	font-style:normal;
	font-weight:normal;
	line-height:16px;
	margin:0;
	padding:4px;
}
</style>

<!---------
// 前処理
---------->
<script>
	// Microsoft 独自仕様？
	const uA = window.navigator.userAgent.toLowerCase();

	if(uA.indexOf("edge") > -1 || uA.indexOf("trident") > -1 || uA.indexOf("msie") > -1){
		alert("このブラウザでは正しく動作しないことがあります。\n\n【動作確認済】\n・Firefox\n・Google Chrome\n・Opera\n・Vivaldi");
	}

	// muni.js を使うためのおまじない
	const GSI = {ClientMode:{}, Modal:{}, Draw:{}, Edit:{}, Control:{}, Utils:{Browser:{}}, GLOBALS:{}, TEXT:{}};
</script>
<script type="text/javascript" src="https://maps.gsi.go.jp/js/muni.js"></script>

<script>
/*-----------------------
// フレームサイズを調整
-----------------------*/
let $NaviCommanderPaddingLR = 14;
let $MapTop = 24;

function subInitDisp(){
	const mapH = window.innerHeight;
	const mapW = window.innerWidth;

	// _divNaviCommander
	document.getElementById("_divNaviCommander").style.width = (mapW - $NaviCommanderPaddingLR) + "px";

	// _divMap
	with(document.getElementById("_divMap").style){
		height = (mapH - $MapTop) + "px";
		top    = $MapTop + "px";
		width  = mapW + "px";
	}
}
/*--------------------
// URL／BL表示を変更
--------------------*/
function subChangeUrl(
	$Lat,
	$Lng,
	$Zoom
){
	for(let _i1 = 0, _i2 = arguments.length; _i1 < _i2; _i1++){
		if(isNaN(arguments[_i1])){
			arguments[_i1] = document.getElementById(arguments[_i1]).value;
		}
	}
	document.getElementById("_NaviLat").value  = parseFloat($Lat).toFixed(8);
	document.getElementById("_NaviLng").value  = parseFloat($Lng).toFixed(8);
	document.getElementById("_NaviZoom").value = $Zoom;

	// URL置換
	history.replaceState(
		null,
		null,
		("#" + $Zoom + "/" + $Lat + "/" + $Lng)
	);
}
/*---------------
// 数値入力補完
---------------*/
// 大域変数
let $subIwmInput_BL_now = null;
let $subIwmInput_BL_toSave = null;

// 環境に合わせて設定
let $subIwmInput_array = ["_InputBL"];

function subIwmInput_Init(){
	for(let _s1 of $subIwmInput_array){
		subIwmInput_Close(_s1);
	}
}
function subIwmInput_ZoomA_Open(
	$outputId, // [id]
	$posX,     // INT
	$posY      // INT
){
	subIwmInput_Open("_InputZoomA", $outputId, $posX, $posY, true);
}
function subIwmInput_ZoomA_Close(){
	subIwmInput_Close("_InputZoomA");
}
function subIwmInput_Zoom_Change(
	$str
){
	document.getElementById("_NaviZoom").value = parseInt($str, 10);

	const color1 = "#000";
	const color2 = "#0c4b9d";

	const obj1 = document.getElementsByClassName("_ZA");
	const obj2 = document.getElementsByClassName("_ZB");

	let i1 = $str;
	let i2 = 0;
	let i3 = obj1.length;

	for(; i2 < i3; i2++){
		obj1[i2].style.background = (i1 == obj1[i2].value ? color2 : color1);

		if(i1 == obj1[i2].value){
			obj1[i2].style.background = color2;
			obj1[i2].style.opacity = 0.8;
		}
		else{
			obj1[i2].style.background = color1;
			obj1[i2].style.opacity = 0.6;
		}

		if(i1 == obj2[i2].value){
			obj2[i2].style.background = color2;
			obj2[i2].style.opacity = 0.8;
		}
		else{
			obj2[i2].style.background = color1;
			obj2[i2].style.opacity = 0.6;
		}
	}

	subIwmInput_Close("_InputZoomA");
}
function subIwmInput_BL_Open(
	$outputId // [id]
){
	if(!document.getElementById($outputId).value.length){
		return;
	}
	const iId = "_InputBL";
	$subIwmInput_BL_toSave = $outputId;
	// "_InputBL" を更新
	_iwmIBL($outputId);
	subIwmInput_Open(iId, $outputId, null, null, false);
}
function subIwmInput_BL_Close(){
	document.getElementById($subIwmInput_BL_toSave).value = rtnGeoIBLto10A(
		document.getElementById("_IBL0").value,
		document.getElementById("_IBL1").value,
		document.getElementById("_IBL2").value
	);
	subIwmInput_Close("_InputBL");
}
function subIwmInput_BL_GetId(
	$outputId // [id]
){
	$subIwmInput_BL_now = $outputId;
}
function subIwmInput_BL_Keydown(
	$outputId,   // [id]
	$decimalSize // 小数点桁数
){
	if($decimalSize == undefined){
		$decimalSize = 0;
	}

	// 他のコントロールに影響するので、
	// 都度、document.onkeydown = function(evt){} で初期化すること。
	document.onkeydown = function(evt){
		switch(evt.keyCode){
			case(13): // [Enter]
				const obj = document.getElementById($outputId);
				const d1 = parseFloat(obj.value).toFixed($decimalSize);

				if(isNaN(d1)){
					return;
				}
				obj.value = d1;

				if($subIwmInput_BL_now == null){
					_iwmIBL(d1);
				}
				else{
					document.getElementById($subIwmInput_BL_toSave).value = rtnGeoIBLto10A(
						document.getElementById("_IBL0").value,
						document.getElementById("_IBL1").value,
						document.getElementById("_IBL2").value
					);
				}
				// ベースマーカー再描画
				_iwmBMN();
				// URL／BL表示を変更
				_iwmCU();
				// センタリング
				_iwmCM();
				// 距離円再描画
				subGCircle_Draw();
			break;
		}
	}
}
function subIwmInput_Open(
	$inputId,   // [id]
	$outputId,  // [id]
	$posX,      // iNT
	$posY,      // INT
	$autoHidden // BOOL
){
	$subIwmInput_BL_now = $outputId;

	// 他の入力フォームを全て閉じる
	subIwmInput_Init();

	const obj = document.getElementById($outputId);
	const rect = obj.getBoundingClientRect();

	const _posX = ($posX == null || $posX == undefined ? rect.left + window.pageXOffset : $posX);
	const _posY = ($posY == null || $posY == undefined ? rect.top + window.pageYOffset + obj.clientHeight : $posY);

	// with()において、
	// 「WebKitではプロパティ名と変数名を自動判別しない → プロパティ名優先 → エラーと見なさない」ので注意!!
	with(document.getElementById($inputId).style){
		display = "";
		left    = _posX + "px";
		top     = _posY + "px";
	}

	// 設定ミリ秒後に自動終了
	if($autoHidden){
		setTimeout("subIwmInput_Close('" + $inputId + "')", 2500);
	}
}
function subIwmInput_Close(
	$outputId // [id]
){
	try{
		document.getElementById($outputId).style.display = "none";
	}
	catch(e){
	}
	// 初期化
	$subIwmInput_BL_now = null;
	document.onkeydown = function(evt){}
}
let $subIwmInput_strPos = 0;
function subIwmInput_AddText(
	$str
){
	const obj = document.getElementById($subIwmInput_BL_now);
	const strBefore = obj.value;
	const strBeforeLen = strBefore.length;
	$subIwmInput_strPos = obj.selectionStart;
	obj.value = strBefore.substr(0, $subIwmInput_strPos) + $str + strBefore.substr($subIwmInput_strPos, strBeforeLen);
	$subIwmInput_strPos++;
	// 再フォーカス
	document.getElementById($subIwmInput_BL_now).focus();
	obj.selectionStart = $subIwmInput_strPos;
}
function subIwmInput_Cls(){
	document.getElementById($subIwmInput_BL_now).value = "";
	// 再フォーカス
	document.getElementById($subIwmInput_BL_now).focus();
	$subIwmInput_strPos = 0;
}
function subIwmInput_Bs(){
	const obj = document.getElementById($subIwmInput_BL_now);
	const strBefore = obj.value;
	const strBeforeLen = strBefore.length;
	$subIwmInput_strPos = obj.selectionStart;
	$subIwmInput_strPos--;
	if($subIwmInput_strPos < 0){
		$subIwmInput_strPos = 0;
	}
	obj.value = strBefore.substr(0, $subIwmInput_strPos) + strBefore.substr(($subIwmInput_strPos + 1), strBeforeLen);
	// 再フォーカス
	document.getElementById($subIwmInput_BL_now).focus();
	obj.selectionStart = $subIwmInput_strPos;
}
function subIwmInput_Del(){
	const obj = document.getElementById($subIwmInput_BL_now);
	const strBefore = obj.value;
	const strBeforeLen = strBefore.length;
	$subIwmInput_strPos = obj.selectionStart;
	if($subIwmInput_strPos > strBeforeLen){
		$subIwmInput_strPos = strBeforeLen;
	}
	obj.value = strBefore.substr(0, $subIwmInput_strPos) + strBefore.substr(($subIwmInput_strPos + 1), strBeforeLen);
	// 再フォーカス
	document.getElementById($subIwmInput_BL_now).focus();
	obj.selectionStart = $subIwmInput_strPos;
}
/*-------------
// エイリアス
-------------*/
// "_InputBL" を更新
function _iwmIBL(
	$d1 // DBL
){
	if(isNaN($d1)){
		$d1 = document.getElementById($d1).value;
	}
	const [deg, min, sec] = rtnGeo10toIBL($d1);
		document.getElementById("_IBL0").value = deg.toFixed(0);
		document.getElementById("_IBL1").value = min.toFixed(0);
		document.getElementById("_IBL2").value = sec.toFixed(8);
}
// ベースマーカー再描画
function _iwmBMN(){
	subBaseMarkerNew("_NaviLat", "_NaviLng");
}
// URL／BL表示を変更
function _iwmCU(){
	subChangeUrl("_NaviLat", "_NaviLng", "_NaviZoom");
}
// センタリング
let $iwmCM_hash = null;
function _iwmCM(){
	if($iwmCM_hash){
		$Map.setView(
			[
				$iwmCM_hash.lat,
				$iwmCM_hash.lng
			],
			document.getElementById("_NaviZoom").value
		);
		$iwmCM_hash = null;
	}
	else{
		$Map.setView(
			[
				document.getElementById("_NaviLat").value,
				document.getElementById("_NaviLng").value
			],
			document.getElementById("_NaviZoom").value
		);
	}
}
function _iwmZA(
	$str
){
	subIwmInput_ZoomA_Close();
	subIwmInput_Zoom_Change($str);
	// ベースマーカー再描画
	_iwmBMN();
	// URL／BL表示を変更
	_iwmCU();
	// センタリング
	_iwmCM();
}
function _iwmZA2(){
	subIwmInput_ZoomA_Close();
	// センタリング
	_iwmCM();
}
function _iwmZB(
	$str
){
	subIwmInput_Zoom_Change($str);
	// URL／BL表示を変更
	_iwmCU();
	// センタリング
	$Map.setView(
		$Map.getCenter(),
		document.getElementById("_NaviZoom").value
	);
}
function _iwmBL(){
	for(let _i1 = 0; _i1 < 3; _i1++){
		if(!document.getElementById("_IBL" + _i1).value.length){
			return;
		}
	}
	subIwmInput_BL_Close();
	// URL／BL表示を変更
	_iwmCU();
	// ベースマーカー再描画
	_iwmBMN();
	// センタリング
	_iwmCM();
	// 距離円再描画
	subGCircle_Draw();
}
/*---------------------
// アドレスマッチング
---------------------*/
let $subAddMatch_Cnt = 0;
let $AddMatchMarker = null;
const $HashAddMatchOutputZoom = {exist:"<i class=\"fa fa-arrow-circle-up\"></i>", none:"<i class=\"fa fa-arrow-circle-down\"></i>"};

// 初期化
function subAddMatch_Init(){
	// 初期化
	$subAddMatch_Cnt = 0;

	// Input
	with(document.getElementById("_AddMatchInput10")){
		value = "";
		focus();
	}
	// Zoom
	document.getElementById("_AddMatchInput20").style.display = "none";

	// Reset
	document.getElementById("_AddMatchInput30").style.display = "none";

	// Output
	with(document.getElementById("_AddMatchOutput")){
		style.display = "none";
		const obj = document.getElementById("_AddMatchInput10");
		const rect = obj.getBoundingClientRect();
		style.left = (rect.left + window.pageXOffset - 2) + "px";
		style.top  = (rect.top + window.pageYOffset + obj.clientHeight - 1) + "px";
		innerHTML = "";
	}
}
function subAddMatch_Main(){
	const query = document.getElementById("_AddMatchInput10").value;

	if(!query.trim().length){
		subAddMatch_Init();
		return;
	}
	const _URL = "https://msearch.gsi.go.jp/address-search/AddressSearch?q=" + query;

	fetch(_URL).then(function(response){
		return response.json();
	}).then(function(json){
		$subAddMatch_Cnt = json.length;

		// 再検索時に結果を表示させるため
		document.getElementById("_AddMatchInput20").innerHTML = $HashAddMatchOutputZoom.none;

		const flg = rtnAddMatch_Main();
		if(flg){
			with(document.getElementById("_AddMatchOutput")){
				let rtn = "<div id='_AddMatchOutputH'>◆ヒット数 " + $subAddMatch_Cnt + " 件</div>";
				for(let _s1 of json){
					with(_s1){
						let _s2 = "";
						// データ不完全のため例外処理が必要
						try{
							const addCode = parseInt(properties.addressCode, 10) + "";
							const a1 = GSI.MUNI_ARRAY[addCode].split(",");
							_s2 = a1[1] + " " + a1[3].replace("　", " ");
						}
						catch(e){
						}
						let [lng, lat] = geometry.coordinates;

						rtn += "<div id=\"_AddMatchOutput1\" onmouseover=\"subAddMatch_Spot([" + lat + "," + lng + "],'" + properties.title + "');\" onmouseout=\"subAddMatch_SpotClear();\" onclick=\"subMapOnRClick('" + lat + "','" + lng + "','" + properties.title + "');\">" +
							"<div class='_AddMatchRem'>" + _s2 + "</div>" +
							properties.title + "</div>";
					}
				}
				// 著作権表示
				rtn += "<div id='_AddMatchOutputF'>【<a href='http://newspat.csis.u-tokyo.ac.jp/geocode/' target='_blank'>協力:東大CSIS</a>】</div>";
				innerHTML = rtn;
			}
		}
	}).catch(function(e){
	});
}
function rtnAddMatch_Main(){
	let rtn = true;

	const oInput2 = document.getElementById("_AddMatchInput20");
	const oInput3 = document.getElementById("_AddMatchInput30");
	const oOutput = document.getElementById("_AddMatchOutput");

	if($subAddMatch_Cnt > 1000){
		oInput2.style.display = "none";
		oInput3.style.display = "";
		with(oOutput){
			style.display = "";
			style.height  = "auto";
			innerHTML     = "★ヒット数が1000件超あります!!<br>　条件を増やしてみてください。";
		}
		rtn = false;
	}
	else if($subAddMatch_Cnt > 0){
		oInput2.style.display = "";
		oInput3.style.display = "";
		oOutput.style.display = "";

		if(oInput2.innerHTML == $HashAddMatchOutputZoom.exist){
			oInput2.innerHTML = $HashAddMatchOutputZoom.none;
			oOutput.style.display = "none";
		}
		else{
			oInput2.innerHTML = $HashAddMatchOutputZoom.exist;
			oOutput.style.display = "";
			rtn = true;
		}
	}
	else{
		oInput2.style.display = "none";
		oInput3.style.display = "";
		with(oOutput){
			style.display = "";
			style.height  = "auto";
			innerHTML     = "★ヒット数が0件です。<br>　条件を変えてみてください。";
		}
		rtn = false;
	}

	return rtn;
}
function subAddMatch_Spot(
	$aLatLng,
	$title
){
	$AddMatchMarker = (
		L.circleMarker(
			$aLatLng,
			{
				radius:8,
				color:"#ff5",
				fill:true,
				fillColor:"#f00",
				fillOpacity:0.8,
				title:$title,
				weight:8
			}
		).addTo($Map).bindPopup(
			$title,
			{
				autoPan:false,
				closeButton:false
			}
		).openPopup()
	);
	// 距離円再描画
	subGCircle_Draw();
}
function subAddMatch_SpotClear(){
	if($AddMatchMarker){
		$AddMatchMarker.remove($Map);
		$AddMatchMarker = null;
	}
	// 距離円再描画
	subGCircle_Draw();
}
/*-------------------------------
// 緯度経度⇒アドレスマッチング
-------------------------------*/
function subLatLngToPlaceName(
	$lat,
	$lng,
	$oMarker,
	$placeName
){
	const _URL = "https://mreversegeocoder.gsi.go.jp/reverse-geocoder/LonLatToAddress?lat=" + $lat + "&lon=" + $lng;

	fetch(_URL).then(function(response){
		return response.json();
	}).then(function(json){
		let title = null;
		if(typeof(json.results) === "undefined"){
			title = "-----";
		}
		else{
			const muniCd = parseInt(json.results.muniCd, 10);
			const lv01Nm = json.results.lv01Nm;
			const a1 = GSI.MUNI_ARRAY[muniCd].split(",");
			title = (a1[1] + a1[3] + lv01Nm).replace(/　/g, "");
		}
		// 地名付与 ⇒ 自由／固定区別
		if($oMarker.options.draggable){
			$oMarker.options.title = title;
		}
		else{
			// 固定点地名 ⇒ 初回に付与してあればパス
			if(!$oMarker.options.title){
				$oMarker.options.title = $placeName + "<br><font color = \"#333\">＠" + title + "</font>";
			}
		}
	}).catch(function(e){
	});
}
/*----------------
// Simple Window
----------------*/
const $AryNaviCommanderId = ['_NC06','_NC05','_NC04','_NC03','_NC02','_NC01'];
const $ArySimpleWindowId = ['_SW06','_SW05','_SW04','_SW03','_SW02','_SW01'];

function subSimpleWindow_Init(
	$aryId
){
	let i1 = $aryId.length;
	while(i1--){
		document.getElementById($aryId[i1]).style.display = "none";
	}
}
function subSimpleWindow_OpenClose(
	$id,
	$btnId
){
	const s1 = document.getElementById($id).style.display;

	for(let _s1 of $AryNaviCommanderId){
		document.getElementById(_s1).style.background = "";
	}

	for(let _s1 of $ArySimpleWindowId){
		document.getElementById(_s1).style.display = "none";
	}

	if(s1.length){
		document.getElementById($id).style.display = "";
		document.getElementById($btnId).style.background = "#3c639b";
	}
}
/*---------------
// 地図から読込
---------------*/
function subMapToPoint(
	$textareaId
){
	let str = document.getElementById($textareaId).value

	// 表示更新されてないと読込エラーになるので意図的にポップアップ
	subMarkerPopup($BaseMarker, $AryLocalMarker);

	for(let _o1 of $AryLocalMarker){
		let _s1 = _o1._popup._content;

		if(_s1.match(/\.\d{4}度$/)){
			_s1 = _s1.substring(0, _s1.lastIndexOf("<br>"));
		}

		// Popup "<br/>" <=> TSV "\t"
		// HTML上の改行表記は "<br>"
		_s1 = _s1.replace(/<br\/>/g, "\t");

		str += _o1._latlng.lat.toFixed(8) + "\t" + _o1._latlng.lng.toFixed(8) + "\t" + _s1 + "\n";
	}
	// 上書き
	document.getElementById($textareaId).value = str;
}
/*----------------------
// ファイル読込（追加）
----------------------*/
let $SaveFileName = "";

function subAddFile(
	$fileId,
	$textareaId,
	$mode // 0:上書き／1:追記
){
	$mode = parseInt($mode, 10);
	// ボタンにイベントを設定
	const fileList = document.getElementById($fileId).files;
	// ファイル名記憶
	$SaveFileName = fileList[0].name;
	// 読込
	const reader = new FileReader();
	reader.onload = function(evt){
		// 追記
		if($mode == 1){
			document.getElementById($textareaId).value += evt.target.result;
		}
		// 上書き
		else{
			document.getElementById($textareaId).value = evt.target.result;
		}
	}
	// 発火
	reader.readAsText(fileList[0]);
}
/*---------------
// 住所から変換
---------------*/
function subA2P_Geocoding(
	$textareaId
){
	const _URL = "https://msearch.gsi.go.jp/address-search/AddressSearch?q=";
	let str = "";
	let errCnt = 0;

	const xhr = new XMLHttpRequest();
	for(let _s1 of document.getElementById($textareaId).value.trimEnd().split("\n")){
		_s1 = _s1.trim();
		const _a1 = _s1.split("\t");
		const query = _a1[0];
		if(query){
			if(query.match(/^\d+\.*\d*/) || query.substr(0, 2) == "//"){
				str += _s1;
			}
			else{
				// バッチ処理のため非同期は不可
				xhr.open("GET", (_URL + query), false);
				xhr.send(null);

				const json = JSON.parse(xhr.responseText);

				if(json.length == 1){
					const [lng, lat] = json[0].geometry.coordinates;
					let _a2 = [];

					_a2 = rtnGeo10toIBL(lat);
					const _lat = "<font color=\"#3d7cce\">北緯</font>" + _a2[0] + "度" + _a2[1] + "分" + _a2[2].toFixed(6) + "秒／" + lat.toFixed(6) + "度";

					_a2 = rtnGeo10toIBL(lng);
					const _lng = "<font color=\"#3d7cce\">東経</font>" + _a2[0] + "度" + _a2[1] + "分" + _a2[2].toFixed(6) + "秒／" + lng.toFixed(6) + "度";

					str += lat.toFixed(8) + "\t" + lng.toFixed(8) + "\t" + "<font color=\"#ff5858\">" + _a1[1] + "</font><br>＠<font color=\"#333\">" + _a1[0] + "</font>" + "\t" + _lat + "\t" + _lng + "\t" + _a1.slice(2).join("\t");
				}
				else{
					str += "// Err " + (json.length == 0 ? "該当なし" : "複数該当あり") + " => " + _s1;
					errCnt++;
				}
			}
			str += "\n";
		}
	}

	if(str){
		document.getElementById($textareaId).value = str;
	}

	with(document.getElementById($textareaId).style){
		if(errCnt){
			color = "#fff";
			backgroundColor = "#855896";
		}
		else{
			color = "#000";
			backgroundColor = "#fff";
		}
	}
}
/*---------------
// サンプル出力
---------------*/
function subA2P_GeocodingSample(
	$textareaId
){
	document.getElementById($textareaId).value = "千代田区千代田1-1\t皇居\nつくば市北郷1\t国土地理院\n";
}
/*---------
// 初期化
---------*/
function subA2P_EditInit(
	$textareaId
){
	document.getElementById($textareaId).value = "";
}
/*-------------
// 地図へ反映
-------------*/
let $AryPoint = [];

function subA2P_addToMap(
	$textareaId
){
	let i1 = $AryPoint.length;
	while(i1--){
		// マーカー消去
		$AryPoint[i1].remove($Map);
		// 配列から削除
		$AryPoint.splice(i1, 1);
	}

	$Map.createPane("_pane230").style.zIndex = 230;
	$Map.createPane("_pane250").style.zIndex = 250;
	let str = "";

	for(let _s1 of document.getElementById($textareaId).value.trimEnd().split("\n")){
		_s1 = _s1.trim();

		// Popup "<br/>" <=> TSV "\t"
		// HTML上の改行表記は "<br>"
		_s1 = _s1.replace(/\\t/g, "\t");
		_s1 = _s1.replace(/\\n/g, "<br>");

		const _a1 = _s1.split("\t");

		// "icon@画像ファイル" でマーカー変更
		let objIcon = null;

		if(_a1.length >= 2){
			try{
				if(_a1.length >= 3){
					_s2 = _a1[2];

					for(let _i1 = 3, _i2 = _a1.length; _i1 < _i2; _i1++){
						const _s3 = _a1[_i1].match(/icon@(.+)/i);
						if(_s3){
							objIcon = L.icon(
								{
									iconUrl:_s3[1],
									iconRetinaUrl:_s3[1],
									iconSize:[24, 24],
									iconAnchor:[12, 12],
									popupAnchor:[0, -10]
								}
							);
						}
						else{
							_s2 += "<br>" + _a1[_i1];
						}
					}
				}
				else{
					_s2 = "<br>";
				}

				const obj1 = (
					objIcon ?
						L.marker(
							[_a1[0], _a1[1]],
							{
								icon:objIcon,
								pane:"_pane250"
							}
						)
					:
						L.circleMarker(
							[_a1[0], _a1[1]],
							{
								color:"#000",
								fill:true,
								fillColor:"#f00",
								fillOpacity:0.8,
								pane:"_pane230",
								radius:6,
								title:_a1[2],
								weight:2
							}
						)
				).addTo($Map);

				const obj2 = obj1.bindPopup(
					_s2,
					{
						autoClose:true,
						autoPan:false,
						closeButton:true,
						closeOnClick:true
					}
				).openPopup();

				obj2.on(
					"mouseover",
					function(e){
						this.openPopup();
					}
				);

				$AryPoint.push(obj2);
			}
			catch(e){
			}

			str += _s1 + "\n";
		}
	}

	if(str){
		document.getElementById($textareaId).value = str;
	}
}
/*-----------------
// ファイルに保存
-----------------*/
function subA2P_EditSave(
	$textareaId
){
	const content = document.getElementById($textareaId).value;
	const blob = new Blob([content], {type:"text/plain"});
	const fn = ($SaveFileName ? $SaveFileName : "マーカー変換.tsv");

	// MSIE?
	if(window.navigator.msSaveBlob){
		window.navigator.msSaveBlob(blob, fn);
		window.navigator.msSaveOrOpenBlob(blob, fn);
	}
	else{
		document.getElementById("_btnDL").download = fn;
		document.getElementById("_btnDL").href = window.URL.createObjectURL(blob);
	}
}
/*---------
// クリア
---------*/
function subA2P_EditClear(
	$textareaId,
	$gcircleId,
	$distCbId,
	$distTextId
){
	// 範囲円
	document.getElementById($gcircleId).value = 0;
	subA2P_GCircle($gcircleId, $textareaId);

	// 総距離
	document.getElementById($distCbId).checked = false;
	subA2P_DistMP($textareaId, $distTextId, false);

	// ローカルマーカー
	let i1 = $AryPoint.length;
	while(i1--){
		$AryPoint[i1].remove($Map);
		$AryPoint.splice(i1, 1);
	}
}
/*----------------------
// Leaflet.greatCircle
----------------------*/
let $AryM2P_Circle = [];

function subA2P_GCircle(
	$selectId,
	$textareaId
){
	// 消去
	for(let _s1 of $AryM2P_Circle){
		_s1.remove();
	}

	// 描画
	let rad = document.getElementById($selectId).value.toLowerCase();
	const a1 = rad.match(/(\d+\.*\d*)(km|m)/);

	if(a1){
		rad = parseFloat(a1[1]);
		if(a1[2] == "km"){
			rad *= 1000;
		}
	}
	else{
		rad = parseFloat(rad);
		document.getElementById($selectId).value = (rad / 1000) + "km";
	}

	if(isNaN(rad) || rad == 0){
		document.getElementById($selectId).value = "";
		return;
	}

	$Map.createPane("_pane210").style.zIndex = 210;
	let i1 = 0;

	for(let _s1 of document.getElementById($textareaId).value.trimEnd().split("\n")){
		_s1 = _s1.trim();

		try{
			const _a1 = _s1.split("\t");
			$AryM2P_Circle[i1] = L.greatCircle(
				[_a1[0], _a1[1]],
				{
					radius:rad,
					color:"#f50",
					fill:true,
					fillColor:"#faa",
					fillOpacity:0.1,
					pane:"_pane210"
				}
			);
			$AryM2P_Circle[i1].addTo($Map);
			i1++;
		}
		catch(e){
		}
	}
}
/*---------------
// 多点間の距離
---------------*/
let $ObjPointLinkedLine = null;
let $rtnA2P_DistMP_PartKm = 0.0;

function rtnA2P_DistMP(
	$textareaInputId
){
	let iErrCnt = 0;
	let aLatLng1 = [];
	const rgxDecimal = /^[\+\-]{0,1}[0-9]+\.{0,1}[0-9]*$/;

	for(let _s1 of document.getElementById($textareaInputId).value.trimEnd().split("\n")){
		if(_s1.substr(0, 2) != "//"){
			const _a1 = _s1.split("\t");
			if(_a1.length >= 2){
				if(!_a1[0].match(rgxDecimal) || !_a1[1].match(rgxDecimal)){
					++iErrCnt;
				}
				else{
					aLatLng1.push([_a1[0], _a1[1]]);
				}
			}
		}
	}

	let iTotalDist = 0.0;
	let aLatLng2 = [];
	let aOld = [];

	// 総距離を仮計算
	for(let _a1 of aLatLng1){
		if(aOld[0]){
			iTotalDist += rtnGeoVincentryA(aOld[0], aOld[1], _a1[0], _a1[1])[0];
		}
		aOld = _a1;
	}
	aOld = [];

	// 区間距離 = 200分割 ※地理院地図は300分割／サーバサイド処理のため速い
	$rtnA2P_DistMP_PartKm = iTotalDist / 200;

	for(let _a1 of aLatLng1){
		if(aOld[0]){
			for(let _a2 of rtnGeoVincentryC(aOld[0], aOld[1], _a1[0], _a1[1], $rtnA2P_DistMP_PartKm)){
				aLatLng2.push([_a2[0], _a2[1]]);
			}
		}
		aOld = _a1;
	}
	aLatLng1 = null;
	aOld = null;

	return [iTotalDist, aLatLng2, iErrCnt];
}
function subA2P_DistMP(
	$textareaInputId,
	$textareaOutputId,
	$bool
){
	// 線消去
	if($ObjPointLinkedLine){
		$Map.removeLayer($ObjPointLinkedLine);
	}

	if(!$bool){
		document.getElementById($textareaOutputId).value = "";
		return;
	}
	const [iTotalDist, aLatLng, iErrCnt] = rtnA2P_DistMP($textareaInputId);

	$Map.createPane("_pane240").style.zIndex = 240;

	// 線描画
	$ObjPointLinkedLine = L.polyline(
		aLatLng,
		{
			color:"#008",
			opacity:0.8,
			pane:"_pane240",
			weight:4
		}
	).addTo($Map);

	document.getElementById($textareaOutputId).value = iTotalDist.toFixed(3) + "km" + (iErrCnt > 0 ? "*" : "");
}
/*-------------------
// 度分秒 => 十進法
-------------------*/
function rtnGeoIBLto10A(
	$deg, // 度
	$min, // 分
	$sec  // 秒
){
	$deg = parseInt($deg, 10);
	$min = parseInt($min, 10);
	$sec = parseFloat($sec);
	return parseFloat($deg + ($min / 60.0) + ($sec / 3600.0));
}
/*-------------------
// 十進法 => 度分秒
-------------------*/
function rtnGeo10toIBL(
	$angle // 十進法
){
	$angle = parseFloat($angle);

	let sign = 1;

	if($angle < 0){
		sign = -1;
		$angle = -$angle;
	}
	let deg = parseInt($angle, 10);
		$angle = ($angle - deg) * 60.0;
	let min = parseInt($angle, 10);
		$angle -= min;
	let sec = parseFloat($angle) * 60.0;

	// 0.999... * 60 => 60.0 対策
	if(sec == 60.0){
		min += 1;
		sec = 0;
	}

	return [parseInt(deg, 10) * sign, parseInt(min, 10), parseFloat(sec)];
}
/*-------------
// Vincenty法
-------------*/
/*【参考】
	http://tancro.e-central.tv/grandmaster/script/vincentyJS.html
*/
function rtnGeoVincentryA(
	$lat1,
	$lng1,
	$lat2,
	$lng2
){
	if($lat1 == $lat2 && $lng1 == $lng2){
		return [0.0, 0.0];
	}

	/// const A = 6378137.0;
	const _B   = 6356752.314140356;    // GRS80
	const _F   = 0.003352810681182319; // 1 / 298.257222101
	const _RAD = 0.017453292519943295; // π / 180

	$lat1 = parseFloat($lat1) * _RAD;
	$lng1 = parseFloat($lng1) * _RAD;
	$lat2 = parseFloat($lat2) * _RAD;
	$lng2 = parseFloat($lng2) * _RAD;

	const f1 = 1 - _F;
	const omega = $lng2 - $lng1;
	const tanU1 = f1 * Math.tan($lat1);
	const cosU1 = 1 / Math.sqrt(1 + tanU1 * tanU1);
	const sinU1 = tanU1 * cosU1;
	const tanU2 = f1 * Math.tan($lat2);
	const cosU2 = 1 / Math.sqrt(1 + tanU2 * tanU2);
	const sinU2 = tanU2 * cosU2;

	let lamda     = omega;
	let dLamda    = 0;
	let sinLamda  = 0.0;
	let cosLamda  = 0.0;
	let sin2Sigma = 0.0;
	let sinSigma  = 0.0;
	let cosSigma  = 0.0;
	let sigma     = 0.0;
	let sinAlpha  = 0.0;
	let cos2Alpha = 0.0;
	let cos2sm    = 0.0;
	let c = 0.0;

	while(true){
		sinLamda = Math.sin(lamda);
		cosLamda = Math.cos(lamda);
		sin2Sigma = (cosU2 * sinLamda) * (cosU2 * sinLamda) + (cosU1 * sinU2 - sinU1 * cosU2 * cosLamda) * (cosU1 * sinU2 - sinU1 * cosU2 * cosLamda);
		if(sin2Sigma < 0){
			return [0.0, 0.0];
		}
		sinSigma = Math.sqrt(sin2Sigma);
		cosSigma = sinU1 * sinU2 + cosU1 * cosU2 * cosLamda;
		sigma = Math.atan2(sinSigma, cosSigma);
		sinAlpha = cosU1 * cosU2 * sinLamda / sinSigma;
		cos2Alpha = 1 - sinAlpha * sinAlpha;
		cos2sm = cosSigma - 2 * sinU1 * sinU2 / cos2Alpha;
		c = _F / 16 * cos2Alpha * (4 + _F * (4 - 3 * cos2Alpha));
		dLamda = lamda;
		lamda = omega + (1 - c) * _F * sinAlpha * (sigma + c * sinSigma * (cos2sm + c * cosSigma * (-1 + 2 * cos2sm * cos2sm)));
		if(Math.abs(lamda - dLamda) <= 1e-12){
			break;
		}
	}

	let u2 = cos2Alpha * (1 - f1 * f1) / (f1 * f1);
	let a = 1 + u2 / 16384 * (4096 + u2 * (-768 + u2 * (320 - 175 * u2)));
	let b = u2 / 1024 * (256 + u2 * (-128 + u2 * (74 - 47 * u2)));
	let dSigma = b * sinSigma * (cos2sm + b / 4 * (cosSigma * (-1 + 2 * cos2sm * cos2sm) - b / 6 * cos2sm * (-3 + 4 * sinSigma * sinSigma) * (-3 + 4 * cos2sm * cos2sm)));
	let km = (_B * a * (sigma - dSigma)) / 1000; // m => km
	let bearing = Math.atan2(cosU2 * sinLamda, cosU1 * sinU2 - sinU1 * cosU2 * cosLamda) * 57.29577951308232;

	// 変換
	if(bearing < 0){
		bearing += 360.0; // 度
	}

	return [km, bearing];
}
function rtnGeoVincentryB(
	$lat,
	$lng,
	$km,
	$bearing
){
	///	const A = 6378137.0;
	const _B   = 6356752.314140356;    // GRS80
	const _F   = 0.003352810681182319; // 1 / 298.257222101
	const _RAD = 0.017453292519943295; // π / 180

	$lat     = parseFloat($lat) * _RAD;
	$lng     = parseFloat($lng) * _RAD;
	$km      = parseFloat($km) * 1000; // km => m
	$bearing = parseFloat($bearing) * _RAD;

	const f1 = 1 - _F;
	const sinBearing = Math.sin($bearing);
	const cosBearing = Math.cos($bearing);
	const tanU1 = f1 * Math.tan($lat);
	const cosU1 = 1 / Math.sqrt((1 + tanU1 * tanU1));
	const sinU1 = tanU1 * cosU1;
	const sigma1 = Math.atan2(tanU1, cosBearing);
	const sinAlfa = cosU1 * sinBearing;
	const cos2Alpha = 1 - sinAlfa * sinAlfa;
	const u2 = cos2Alpha * (1 - f1 * f1) / (f1 * f1);
	const a = 1 + u2 / 16384 * (4096 + u2 * (-768 + u2 * (320 - 175 * u2)));
	const b = u2 / 1024 * (256 + u2 * (-128 + u2 * (74 - 47 * u2)));

	let cos2Sigma  = 0.0;
	let sinSigma   = 0.0;
	let cosSigma   = 0.0;
	let deltaSigma = 0.0;
	let sigma0     = 0.0;
	let sigma9     = $km / (_B * a);

	while(true){
		cos2Sigma = Math.cos(2 * sigma1 + sigma9);
		sinSigma = Math.sin(sigma9);
		cosSigma = Math.cos(sigma9);
		deltaSigma = b * sinSigma * (cos2Sigma + b / 4 * (cosSigma * (-1 + 2 * cos2Sigma * cos2Sigma) - b / 6 * cos2Sigma * (-3 + 4 * sinSigma * sinSigma) * (-3 + 4 * cos2Sigma * cos2Sigma)));
		sigma0 = sigma9;
		sigma9 = $km / (_B * a) + deltaSigma;
		if(Math.abs(sigma9 - sigma0) <= 1e-12){
			break;
		}
	}

	let x = sinU1 * sinSigma - cosU1 * cosSigma * cosBearing;
	let lat2 = Math.atan2(sinU1 * cosSigma + cosU1*sinSigma * cosBearing, f1 * Math.sqrt(sinAlfa * sinAlfa + x * x));
	let Lamda = Math.atan2(sinSigma * sinBearing, cosU1 * cosSigma - sinU1 * sinSigma * cosBearing);
	let c = _F / 16 * cos2Alpha * (4 + _F * (4 - 3 * cos2Alpha));
	let _L = Lamda - (1 - c) * _F * sinAlfa * (sigma9 + c * sinSigma * (cos2Sigma + c * cosSigma * (-1 + 2 * cos2Sigma * cos2Sigma)));
	let lng2 = $lng + _L;
	let bearing2 = Math.atan2(sinAlfa, -x);

	return [(lat2 / _RAD), (lng2 / _RAD), (bearing2 / _RAD)]
}
function rtnGeoVincentryC(
	$lat1,
	$lng1,
	$lat2,
	$lng2,
	$partKm = 10.0
){
	$lat1   = parseFloat($lat1);
	$lng1   = parseFloat($lng1);
	$lat2   = parseFloat($lat2);
	$lng2   = parseFloat($lng2);
	$partKm = parseFloat($partKm);

	let rtn = [];
	let a1 = [];
	let totalKm = 0.0;

	const allKm = rtnGeoVincentryA($lat1, $lng1, $lat2, $lng2)[0];

	while(true){
		rtn.push([$lat1, $lng1, totalKm]);
		const _bearing = rtnGeoVincentryA($lat1, $lng1, $lat2, $lng2)[1];
		a1 = rtnGeoVincentryB($lat1, $lng1, $partKm, _bearing);
			$lat1 = a1[0];
			$lng1 = a1[1];
		if(allKm < (totalKm += $partKm)){
			break;
		}
	}
	rtn.push([$lat2, $lng2, allKm]);

	return rtn;
}
/*-----------
// 標高取得
-----------*/
function subGetElevation(
	$lat,
	$lng,
	$oMarker
){
	const _URL = "https://cyberjapandata2.gsi.go.jp/general/dem/scripts/getelevation.php?lat=" + $lat + "&lon=" + $lng + "&outtype=JSON";

	fetch(_URL).then(function(response){
		return response.json();
	}).then(function(json){
		$oMarker.elevation = json.elevation + "m DEM" + json.hsrc;
	}).catch(function(e){
	});
}
/*---------------------------------
// ポップアップ ← ベースマーカー
---------------------------------*/
function rtnMarkerPopup1(
	$lat,
	$lng
){
	subLatLngToPlaceName($lat, $lng, $BaseMarker, null);

	let [deg, min, sec] = rtnGeo10toIBL($lat);
	const latRem = deg + "度" + min + "分" + parseFloat(sec).toFixed(6) + "秒";

	[deg, min, sec] = rtnGeo10toIBL($lng);
	const lngRem = deg + "度" + min + "分" + parseFloat(sec).toFixed(6) + "秒";

	subGetElevation($lat, $lng, $BaseMarker);

	// Popup "<br/>" <=> TSV "\t"
	// HTML上の改行表記は "<br>"
	return(
		"<font color='#ff5858'>" + $BaseMarker.options.title + "</font><br>" +
		"<font color='#3d7cce'>北緯</font>" + latRem + "／" + $lat.toFixed(6) + "度<br>" +
		"<font color='#3d7cce'>東経</font>" + lngRem + "／" + $lng.toFixed(6) + "度<br>" +
		"<font color='#3d7cce'>標高</font>" + $BaseMarker.elevation
	);
}
/*-----------------------------------
// ポップアップ ← ローカルマーカー
-----------------------------------*/
function rtnMarkerPopup2(
	$latFrom,
	$lngFrom,
	$latTo,
	$lngTo,
	$oMarker
){
	subLatLngToPlaceName($latTo, $lngTo, $oMarker, null);

	let [deg, min, sec] = rtnGeo10toIBL($latTo);
	const latRem = deg + "度" + min + "分" + parseFloat(sec).toFixed(6) + "秒";

	[deg, min, sec] = rtnGeo10toIBL($lngTo);
	const lngRem = deg + "度" + min + "分" + parseFloat(sec).toFixed(6) + "秒";

	let [dist, angle] = rtnGeoVincentryA($latFrom, $lngFrom, $latTo, $lngTo);
		dist = dist.toFixed(4);
		angle = angle.toFixed(4);

	let distRem = dist + "km";

	let angleRem = "";
	if(angle >= 337.5 || angle <= 22.5){
		angleRem = "北";
	}
	else if(angle > 22.5 && angle < 67.5){
		angleRem = "北東";
	}
	else if(angle >= 67.5 && angle <= 112.5){
		angleRem = "東";
	}
	else if(angle > 112.5 && angle < 157.5){
		angleRem = "南東";
	}
	else if(angle >= 157.5 && angle <= 202.5){
		angleRem = "南";
	}
	else if(angle > 202.5 && angle < 247.5){
		angleRem = "南西";
	}
	else if(angle >= 247.5 && angle <= 292.5){
		angleRem = "西";
	}
	else if(angle > 292.5 && angle < 337.5){
		angleRem = "北西";
	}
	angleRem += angle + "度";

	subGetElevation($latTo, $lngTo, $oMarker);

	// Popup "<br/>" <=> TSV "\t"
	// HTML上の改行表記は "<br>"
	return(
		"<font color='#ff5858'>" + $oMarker.options.title + "</font><br>" +
		"<font color='#3d7cce'>北緯</font>" + latRem + "／" + $latTo.toFixed(6) + "度<br>" +
		"<font color='#3d7cce'>東経</font>" + lngRem + "／" + $lngTo.toFixed(6) + "度<br>" +
		"<font color='#3d7cce'>標高</font>" + $oMarker.elevation + "<br>" +
		"<font color='#3d7cce'>距離</font>" + distRem + "／" + angleRem
	);
}
/*------------------------------------
// [マーカー消去]ボタン 表示／非表示
------------------------------------*/
function subMyObj_Init(){
	document.getElementById("_btnMarker").style.display = "none";
}
function subMyObj_OnOff(
	$aryObj
){
	document.getElementById("_btnMarker").style.display = ($aryObj.length > 0 ? "" : "none");
}
/*-----------------------
// ローカルマーカー消去
-----------------------*/
function subMyObj_Remove(
	$aryObj
){
	let obj = null;
	while((obj = $aryObj.pop()) != undefined){
		obj.remove($Map);
	}
	// 距離円再描画
	subGCircle_Draw();
	// [マーカー消去]ボタン 非表示
	document.getElementById("_btnMarker").style.display = "none";
}
/*----------------------
// [Tab]入力可能にする
----------------------*/
/*【参考】
	http://www.webclap-dandy.com/?category=Programing&id=5
*/
function subAddTabCtrl(
	$e,
	$obj
){
	if($e.keyCode != 9){
		return;
	}
	$e.preventDefault();

	const cursorPosition = $obj.selectionStart;
	const cursorLeft     = $obj.value.substr(0, cursorPosition);
	const cursorRight    = $obj.value.substr(cursorPosition, $obj.value.length);

	$obj.value = cursorLeft + "\t" + cursorRight;
	$obj.selectionEnd = cursorPosition + 1;
}
/*---------
// 海水面
---------*/
let $Dem10ToSeaLevel = new L.GridLayer();

function subDem10ToSeaLevel2(
	$id1,
	$id2
){
	try{
		$Dem10ToSeaLevel.remove($Map);

		if(document.getElementById($id1).value < 0){
			document.getElementById($id1).value = 0;
		}

		if(document.getElementById($id2).value < 0){
			document.getElementById($id2).value = 0;
		}
	}
	catch(e){
		return;
	}

	let seaLevel1 = parseFloat(document.getElementById($id1).value);
	let seaLevel2 = parseFloat(document.getElementById($id2).value);

	if(seaLevel1 > seaLevel2){
		let tmp = seaLevel1;
		seaLevel1 = seaLevel2;
		seaLevel2 = tmp;
		tmp = null;

		document.getElementById($id1).value = seaLevel1;
		document.getElementById($id2).value = seaLevel2;
	}

	// 元データの切り上げ対策
	++seaLevel2;

	// m => cm
	seaLevel1 *= 100;
	seaLevel2 *= 100;

	$Dem10ToSeaLevel.createTile = function(coords){
		const tile = L.DomUtil.create("canvas", "leaflet-tile");
			tile.width = tile.height = 256;
		const ctx = tile.getContext("2d");
		const img = new Image();
			img.crossOrigin = "anonymous";
			// leafletが使うタイルと別のサーバ（https／http）にアクセスし、Access-Control-Allow-Originを回避
			img.src = "https://cyberjapandata.gsi.go.jp/xyz/dem_png/" + coords.z + "/" + coords.x + "/" + coords.y + ".png";
		img.onload = function(){
			ctx.drawImage(this, 0, 0);
			const rtnImg = ctx.getImageData(0, 0, 256, 256);
			const rtnImgData = rtnImg.data;
			for(let _i1 = 0, _i2 = rtnImgData.length; _i1 < _i2; _i1+=4){
				let elevation = (rtnImgData[_i1 + 0] * 65536) + (rtnImgData[_i1 + 1] * 256) + rtnImgData[_i1 + 2];
				if(elevation > 8388608){
					elevation = (elevation - 16777216);
				}
				rtnImgData[_i1 + 3] = (elevation >= seaLevel1 && elevation <= seaLevel2 ? 90 : 0);
			}
			ctx.putImageData(rtnImg, 0, 0);
		}
		return tile;
	}
	$Dem10ToSeaLevel.addTo($Map);
}
/*----------------------
// Leaflet.greatCircle
----------------------*/
let $GCircleBase = null;
let $GCircleAryLocal = [];

// 距離円描画
function subGCircle_Draw(){
	$Map.createPane("_pane220").style.zIndex = 220;
	$Map.createPane("_pane210").style.zIndex = 210;

	// ベースマーカー
	if($GCircleBase){
		$GCircleBase.remove();
	}

	$GCircleBase = L.greatCircle(
		$BaseMarker.getLatLng(),
		{
			radius:rtnGCircle_Scale(),
			color:"#00f",
			fill:true,
			fillColor:"#aaf",
			fillOpacity:0.1,
			pane:"_pane220"
		}
	);
	$GCircleBase.addTo($Map);
	$GCircleBase.bindTo($BaseMarker);

	// ローカルマーカー
	for(let _s1 of $GCircleAryLocal){
		_s1.remove();
	}

	$GCircleAryLocal = [];

	for(let _s1 of $AryLocalMarker){
		$GCircleAryLocal.push(
			L.greatCircle(
				_s1.getLatLng(),
				{
					radius:rtnGCircle_Scale(),
					color:"#f00",
					fill:true,
					fillColor:"#faa",
					fillOpacity:0.1,
					pane:"_pane210"
				}
			)
		);
	}

	for(let _i1 = 0; _i1 < $GCircleAryLocal.length; _i1++){
		$GCircleAryLocal[_i1].addTo($Map);
		$GCircleAryLocal[_i1].bindTo($AryLocalMarker[_i1]);
	}
}
// スライダー制御
function subGCircle_Slider(){
	const iDist = rtnGCircle_Scale();
	document.getElementById("$GCircleKm").innerHTML = (iDist / 1000.0).toFixed(2) + "km";

	$GCircleBase.setRadius(iDist);

	for(let _s1 of $GCircleAryLocal){
		_s1.setRadius(iDist);
	}
}
// 目盛毎の単位で変換 (例)10 => 10mスケール
function rtnGCircle_Scale(){
	const scale = 10; // Meter単位
	return parseInt(document.getElementById("_GCircleRange").value, 10) * scale;
}
/*----------------------
// Leaflet.Heightgraph
----------------------*/
let $HeightGraph_On = true;
let $HeightGraph_Layer = null;
let $HeightGraph_Title = "標高グラフ ";
let $HeightGraph_Init = L.control.heightgraph(
	{
		mappings:{
			suitability:function(data){
				return {
					text:"±" + ($rtnA2P_DistMP_PartKm).toFixed(2) + "km",
					color:"#0067c0"
				};
			},
		},
		graphStyle:{
			opacity:0.8,
			'fill-opacity':0.2,
			'stroke-width':'2px'
		},
		expandCallback(expand){},
		expandControls:false,
		highlightStyle:{
			color:"#c71585",
			opacity:0.6,
			weight:6
		},
		position:"bottomleft",
		translation:{
			distance:"距離",
			elevation:"標高",
			segment_length:"総距離",
			type:"精度",
			legend:" "
		},
		width:700,
		height:150
	}
);
let $HeightGraph_Data = [
	{
		"type":"FeatureCollection",
		"features":[
			{
				"type":"Feature",
				"geometry":{
					"type":"LineString",
					"coordinates":[
						// Lng, Lat, M
						// (例)
						[140.4, 38.5, 100.0],[140.6, 38.3, 500.0],[140.7, 38.3, 500.0],[140.9, 38.4, 200.0]
					]
				},
				"properties":{}
			}
		],
		"properties":{
			"Creator":"OpenRouteService.org",
			"records":1,
			"summary":"suitability",
			"label":" "
		}
	}
];
let $HeightGraph_ElevationCash = []; // ["lat@lng", 0]

function rtnHeightGraphElevation(
	$lat,
	$lng
){
	// 精度対速度比を調整（小数４桁縛り）
	$lat = $lat.toFixed(4);
	$lng = $lng.toFixed(4);
	const _KEY = $lat + "@" + $lng;

	for(let _k1 in $HeightGraph_ElevationCash){
		if(_k1 == _KEY){
			// (入力)[Lat, Lng] => (出力)[Lng, Lat] になることに注意
			[$lat, $lng] = _k1.split("@");
			return [$lng, $lat, $HeightGraph_ElevationCash[_k1]];
		}
	}

	const _URL = "https://cyberjapandata2.gsi.go.jp/general/dem/scripts/getelevation.php?lat=" + $lat + "&lon=" + $lng + "&outtype=JSON";
	let rtn = [];

	// バッチ処理のため非同期は不可
	const xhr = new XMLHttpRequest();
	xhr.open("GET", _URL, false);
	xhr.send(null);
	if(xhr.status == 200){
		let i1 = JSON.parse(xhr.responseText).elevation;
		if(i1 == "-----"){
			i1 = 0;
		}
		// (入力)[Lat, Lng] => (出力)[Lng, Lat] になることに注意
		rtn = [$lng, $lat, i1];
		// Cash
		$HeightGraph_ElevationCash[_KEY] = i1;
	}
	return rtn;
}
function subHeightGraphMakeData(){
	// 初期化
	$HeightGraph_Data[0]["features"][0]["geometry"]["coordinates"] = [[0, 0, 0], [0, 0, 0]];
	let [iTotalDist, aLatLng, iErrCnt] = rtnA2P_DistMP("_TA04");

	const allCnt = aLatLng.length;
	const aryBeforeData = [
		document.getElementById("_HgBtn").value,
		document.getElementById("_HgBtn").style.color
	];

	document.getElementById("_HgBtn").style.color = "#000";

	let a1 = [];
	let cnt = 0;

	for(let _a1 of aLatLng){
		a1.push(rtnHeightGraphElevation(_a1[0], _a1[1]));
		// WebKit／Blink系は表示不可
		++cnt;
		document.getElementById("_HgBtn").value = $HeightGraph_Title + parseInt(100 * cnt / allCnt, 10) + "%";
	}

	// 再計算値を代入
	$HeightGraph_Data[0]["features"][0]["geometry"]["coordinates"] = a1;

	a1 = null;

	with(document.getElementById("_HgBtn")){
		value = aryBeforeData[0];
		style.color = aryBeforeData[1];
	}
}
function subHeightGraphOpen(){
	if($HeightGraph_On){
		const flg2 = confirm("処理中は操作ができません。\n処理を開始しますか？");
		if(!flg2){
			return;
		}

		// 標高GeoJSON作成
		subHeightGraphMakeData();

		// グラフ描画
		$HeightGraph_Init.addTo($Map);
		$HeightGraph_Init.addData($HeightGraph_Data);
		/// $HeightGraph_Init.resize({width:700, height:150});

		// 線描画
		$HeightGraph_Layer = new L.LayerGroup();
		$HeightGraph_Layer.addTo($Map);

		// _GCircle(=500) より上位
		$Map.createPane("_pane510").style.zIndex = 510;
		L.geoJson(
			$HeightGraph_Data,
			{
				pane:"_pane510"
			}
		).on(
			{
				'mousemove':event => {$HeightGraph_Init.mapMousemoveHandler(event, {showMapMarker:true});},
				'mouseout':event => {$HeightGraph_Init.mapMouseoutHandler(2000);}
			}
		).addTo($HeightGraph_Layer);

		// 再表示
		$PolylineMeasure.remove($Map);
		$PolylineMeasure.addTo($Map);

		$HeightGraph_On = false;
		document.getElementById("_HgBtn").value = $HeightGraph_Title + "OFF";
	}
	else{
		try{
			$HeightGraph_Init.remove($Map);
			$HeightGraph_Layer.remove($Map);
			$HeightGraph_Layer = null;
		}
		catch(e){
		}
		$HeightGraph_On = true;
		document.getElementById("_HgBtn").value = $HeightGraph_Title + "ON";
	}
}
/*----------
// GeoJSON
----------*/
let $AryGeoJsonLayer = [null, null, null, null, null];

function subAddGeoJson_init()
{
	for(let _i1 = 0; _i1 < $AryGeoJsonLayer.length; _i1++){
		// チェック Off
		document.getElementById("_checkboxGeoJson" + _i1).checked = false;
		// ファイル名クリア
		document.getElementById("_fileGeoJson" + _i1).value = "";
		// レイヤー消去
		if($AryGeoJsonLayer[_i1]){
			$AryGeoJsonLayer[_i1].remove($Map);
			$AryGeoJsonLayer[_i1] = null;
		}
		// Style 変更
		document.getElementById("_fileGeoJson" + _i1).style.color = "#000";
	}
}
function subAddGeoJson_readFile(
	$aryIndex
){
	$aryIndex = parseInt($aryIndex, 10);
	// ボタンにイベントを設定
	const fileList = document.getElementById("_fileGeoJson" + $aryIndex).files;
	// 読込
	const reader = new FileReader();
	reader.onload = function(evt){
		document.getElementById("_TA03").value = evt.target.result;
		// レイヤー作成
		$Map.createPane("_pane200").style.zIndex = 200;
		$AryGeoJsonLayer[$aryIndex] = L.geoJSON(
			JSON.parse(
				document.getElementById("_TA03").value
			),{
				pane:"_pane200"
			}
		).bindPopup(function(layer){
			return layer.feature.properties.name;
		}).bindTooltip(function(layer){
			return layer.feature.properties.name;
		});
	}
	// 発火
	reader.readAsText(fileList[0]);
	// Style 変更
	document.getElementById("_fileGeoJson" + $aryIndex).style.color = "#fff";
}
function subAddGeoJson_addToMap(
	$aryIndex
)
{
	if(document.getElementById("_checkboxGeoJson" + $aryIndex).checked){
		// レイヤー描画
		if($AryGeoJsonLayer[$aryIndex]){
			$AryGeoJsonLayer[$aryIndex].addTo($Map);
		}
	}
	else{
		// レイヤー消去
		if($AryGeoJsonLayer[$aryIndex]){
			$AryGeoJsonLayer[$aryIndex].remove($Map);
		}
	}
}
</script>
</head>

<body onload="subInitDisp();subIwmInput_Init();subMyObj_Init();subAddMatch_Init();subGCircle_Draw();subSimpleWindow_Init($ArySimpleWindowId);" onresize="subInitDisp();">
	<!---------------
	// 数値入力補完
	---------------->
	<div id="_InputZoomA">
		ズームレベル<br>
		<input type="button" class="_ZA" value="5" onclick="_iwmZA('5');"/><input type="button" class="_ZA" value="6" onclick="_iwmZA('6');"/><input type="button" class="_ZA" value="7" onclick="_iwmZA('7');"/><input type="button" class="_ZA" value="8" onclick="_iwmZA('8');"/><input type="button" class="_ZA" value="9" onclick="_iwmZA('9');"/><br>
		<input type="button" class="_ZA" value="10" onclick="_iwmZA('10');"/><input type="button" class="_ZA" value="11" onclick="_iwmZA('11');"/><input type="button" class="_ZA" value="12" onclick="_iwmZA('12');"/><input type="button" class="_ZA" value="13" onclick="_iwmZA('13');"/><input type="button" class="_ZA" value="14" onclick="_iwmZA('14');"/><br>
		<input type="button" class="_ZA" value="15" onclick="_iwmZA('15');"/><input type="button" class="_ZA" value="16" onclick="_iwmZA('16');"/><input type="button" class="_ZA" value="17" onclick="_iwmZA('17');"/><input type="button" class="_ZA" value="18" onclick="_iwmZA('18');"/><input type="button" class="_ZA" value="19" onclick="_iwmZA('19');"/><br>
		<input type="button" class="_ZA" value="20" onclick="_iwmZA('20');"/><input type="button" class="_ZA" value="21" onclick="_iwmZA('21');"/><input type="button" class="_ZA" value="22" onclick="_iwmZA('22');"/><input type="button" class="_ZA" value="23" onclick="_iwmZA('23');"/><div class="_btnNavi1" style="display:inline-block;_display:inline;font-size:14px;height:26px;line-height:26px;margin:2px;padding:0;vertical-align:top;width:26px;" onclick="_iwmZA2();"><i class="fa fa-map-marker"></i></div>
	</div>
	<div id="_InputZoomB">
		<input type="button" class="_ZB" value="23" onclick="_iwmZB('23');"/><br>
		<input type="button" class="_ZB" value="22" onclick="_iwmZB('22');"/><br>
		<input type="button" class="_ZB" value="21" onclick="_iwmZB('21');"/><br>
		<input type="button" class="_ZB" value="20" onclick="_iwmZB('20');"/><br>
		<input type="button" class="_ZB" value="19" onclick="_iwmZB('19');"/><br>
		<input type="button" class="_ZB" value="18" onclick="_iwmZB('18');"/><br>
		<input type="button" class="_ZB" value="17" onclick="_iwmZB('17');"/><br>
		<input type="button" class="_ZB" value="16" onclick="_iwmZB('16');"/><br>
		<input type="button" class="_ZB" value="15" onclick="_iwmZB('15');"/><br>
		<input type="button" class="_ZB" value="14" onclick="_iwmZB('14');"/><br>
		<input type="button" class="_ZB" value="13" onclick="_iwmZB('13');"/><br>
		<input type="button" class="_ZB" value="12" onclick="_iwmZB('12');"/><br>
		<input type="button" class="_ZB" value="11" onclick="_iwmZB('11');"/><br>
		<input type="button" class="_ZB" value="10" onclick="_iwmZB('10');"/><br>
		<input type="button" class="_ZB" value="9" onclick="_iwmZB('9');"/><br>
		<input type="button" class="_ZB" value="8" onclick="_iwmZB('8');"/><br>
		<input type="button" class="_ZB" value="7" onclick="_iwmZB('7');"/><br>
		<input type="button" class="_ZB" value="6" onclick="_iwmZB('6');"/><br>
		<input type="button" class="_ZB" value="5" onclick="_iwmZB('5');"/>
	</div>
	<div id="_InputBL">
		<input type="text" id="_IBL0" onclick="subIwmInput_BL_GetId(this.id);" onkeydown="subIwmInput_BL_Keydown(this.id, 0);" style="width:37px;"/>度<input type="text" id="_IBL1" onclick="subIwmInput_BL_GetId(this.id);" onkeydown="subIwmInput_BL_Keydown(this.id, 0);" style="width:37px;"/>分<br>
		<input type="text" id="_IBL2" onclick="subIwmInput_BL_GetId(this.id);" onkeydown="subIwmInput_BL_Keydown(this.id, 8);" style="width:96px;"/>秒<br>
		<input type="button" class="_Btn1" value="7" onclick="subIwmInput_AddText('7');"/><input type="button" class="_Btn1" value="8" onclick="subIwmInput_AddText('8');"/><input type="button" class="_Btn1" value="9" onclick="subIwmInput_AddText('9');"/><br>
		<input type="button" class="_Btn1" value="4" onclick="subIwmInput_AddText('4');"/><input type="button" class="_Btn1" value="5" onclick="subIwmInput_AddText('5');"/><input type="button" class="_Btn1" value="6" onclick="subIwmInput_AddText('6');"/><br>
		<input type="button" class="_Btn1" value="1" onclick="subIwmInput_AddText('1');"/><input type="button" class="_Btn1" value="2" onclick="subIwmInput_AddText('2');"/><input type="button" class="_Btn1" value="3" onclick="subIwmInput_AddText('3');"/><br>
		<input type="button" class="_Btn1" value="0" onclick="subIwmInput_AddText('0');"/><input type="button" class="_Btn1" value="." onclick="subIwmInput_AddText('.');"/><input type="button" class="_Btn2" value="Cls" onclick="subIwmInput_Cls();"/><br>
		<input type="button" class="_Btn2" value="BS" onclick="subIwmInput_Bs();"/><input type="button" class="_Btn2" value="Del" onclick="subIwmInput_Del();"/><input type="button" class="_Btn3" value="OK" onclick="_iwmBL();"/>
	</div>
	<!---------------------
	// アドレスマッチング
	---------------------->
	<div id="_AddMatchInput">
		<input type="text" id="_AddMatchInput10" onchange="subAddMatch_Main();" placeholder="住所検索"/><font id="_AddMatchInput15" onclick="subAddMatch_Main();"><i class="fa fa-search"></i></font><font id="_AddMatchInput20" onclick="rtnAddMatch_Main();"></font><font id="_AddMatchInput30" onclick="subAddMatch_Init();"><i class="fa fa-times-circle"></i></font>
	</div>
	<div id="_AddMatchOutput"></div>
	<!-----------
	// 拡張機能
	------------>
	<div id="_divNaviCommander">
		北緯&nbsp;<input type="text" id="_NaviLat" onclick="subIwmInput_BL_Open(this.id);" onkeydown="subIwmInput_BL_Keydown(this.id, 8);" placeholder="緯度入力"/>
		東経&nbsp;<input type="text" id="_NaviLng" onclick="subIwmInput_BL_Open(this.id);" onkeydown="subIwmInput_BL_Keydown(this.id, 8);" placeholder="経度入力"/>
		<!-- ズーム --><input type="hidden" id="_NaviZoom"/>
		<div class="_btnNavi1" style="display:inline-block;_display:inline;font-size:14px;line-height:16px;" onclick="_iwmZA2();"><i class="fa fa-map-marker"></i></div>
		<input type="button" id="_btnMarker" class="_btnNavi2" value="マーカー消去" onclick="subMyObj_Remove($AryLocalMarker);"/>
		<!---------
		// ヘルプ
		---------->
		<span id="_NC01" style="float:right;margin:0 8px 0 4px;">
			<font class="_simpleWindowCall" style="font-weight:900;" onclick="subSimpleWindow_OpenClose('_SW01','_NC01');">？</font>
		</span>
		<div id="_SW01" class="_simpleWindow" style="width:320px;">
			<font class="_simpleWindowTitle">操作説明</font>
			<font class="_simpleWindowClose" onclick="subSimpleWindow_OpenClose('_SW01','_NC01');">×</font>
			<div id="_SW01Doc" class="_simpleWindowOutput" style="background:#fff;max-height:600px;padding:0 0 12px 0;"></div>
		</div>
		<!-----------------
		// 追加タイル編集
		------------------>
		<span id="_NC02" style="float:right;margin:0 4px;">
			<font class="_simpleWindowCall" onclick="subSimpleWindow_OpenClose('_SW02','_NC02');">追加タイル編集</font>
		</span>
		<div id="_SW02" class="_simpleWindow" style="width:470px;">
			<font class="_simpleWindowTitle">追加タイル編集</font>
			<font class="_simpleWindowClose" onclick="subSimpleWindow_OpenClose('_SW02','_NC02');">×</font>
			<div class="_simpleWindowOutput" style="padding:0 0 8px 0;text-align:center;">
				<input type="file" id="_fileAddMap" class="_btnNavi2" accept=".tsv" style="font-size:12px;margin:0;width:468px;" onchange="subAddFile(this.id,'_TA02',0);"/>
				<br>
				<textarea id="_TA02" class="_editTextBox" wrap="off" style="height:180px;width:452px;"></textarea>
				<script>
					document.getElementById("_TA02").onkeydown = function(e){subAddTabCtrl(e, this);}
				</script>
				<br>
				<input type="button" class="_btnNavi3" value="←地図へ反映" onclick="subMapSelector();subSimpleWindow_OpenClose('_SW02','_NC02');"/>
				<a class="_btnNavi4" href="http://maps.gsi.go.jp/development/ichiran.html" target="_blank">地理院タイル一覧⇒</a>
			</div>
		</div>
		<!----------
		// GeoJSON
		----------->
		<span id="_NC03" style="float:right;margin:0 4px;">
			<font class="_simpleWindowCall" onclick="subSimpleWindow_OpenClose('_SW03','_NC03');">GeoJSON</font>
		</span>
		<div id="_SW03" class="_simpleWindow" style="width:400px;">
			<font class="_simpleWindowTitle">GeoJSON ファイル読込</font>
			<font class="_simpleWindowClose" onclick="subSimpleWindow_OpenClose('_SW03','_NC03');">×</font>
			<div class="_simpleWindowOutput" style="line-height:36px;text-align:center;">
				<input type="checkbox" id="_checkboxGeoJson0" class="_checkboxNavi1" style="margin:0 8px 0 0;" onchange="subAddGeoJson_addToMap(0);"/><input type="file" id="_fileGeoJson0" class="_btnNavi2" accept=".geojson" style="font-size:12px;margin:0;width:360px;" onchange="subAddGeoJson_readFile(0);"/>
				<br>
				<input type="checkbox" id="_checkboxGeoJson1" class="_checkboxNavi1" style="margin:0 8px 0 0;" onchange="subAddGeoJson_addToMap(1);"/><input type="file" id="_fileGeoJson1" class="_btnNavi2" accept=".geojson" style="font-size:12px;margin:0;width:360px;" onchange="subAddGeoJson_readFile(1);"/>
				<br>
				<input type="checkbox" id="_checkboxGeoJson2" class="_checkboxNavi1" style="margin:0 8px 0 0;" onchange="subAddGeoJson_addToMap(2);"/><input type="file" id="_fileGeoJson2" class="_btnNavi2" accept=".geojson" style="font-size:12px;margin:0;width:360px;" onchange="subAddGeoJson_readFile(2);"/>
				<br>
				<input type="checkbox" id="_checkboxGeoJson3" class="_checkboxNavi1" style="margin:0 8px 0 0;" onchange="subAddGeoJson_addToMap(3);"/><input type="file" id="_fileGeoJson3" class="_btnNavi2" accept=".geojson" style="font-size:12px;margin:0;width:360px;" onchange="subAddGeoJson_readFile(3);"/>
				<br>
				<input type="checkbox" id="_checkboxGeoJson4" class="_checkboxNavi1" style="margin:0 8px 0 0;" onchange="subAddGeoJson_addToMap(4);"/><input type="file" id="_fileGeoJson4" class="_btnNavi2" accept=".geojson" style="font-size:12px;margin:0;width:360px;" onchange="subAddGeoJson_readFile(4);"/>
				<br>
				<textarea id="_TA03" class="_editTextBox" wrap="off" style="display:none;"></textarea>
				<input type="button" class="_btnNavi1" value="↑クリア" onclick="subAddGeoJson_init()"/>
			</div>
		</div>
		<!---------------
		// マーカー変換
		---------------->
		<span id="_NC04" style="float:right;margin:0 4px;">
			<font class="_simpleWindowCall" onclick="subSimpleWindow_OpenClose('_SW04','_NC04');">マーカー変換</font>
		</span>
		<div id="_SW04" class="_simpleWindow" style="width:470px;">
			<font class="_simpleWindowTitle">マーカーをポイントに変換</font>
			<font class="_simpleWindowClose" onclick="subSimpleWindow_OpenClose('_SW04','_NC04');">×</font>
			<div class="_simpleWindowOutput" style="padding:0 8px 8px 8px;">
				<input type="button" class="_btnNavi3" value="→マーカーから読込" onclick="subA2P_EditInit('_TA04');subMapToPoint('_TA04');"/>
				<input type="file" id="_readPointFile" class="_btnNavi2" accept=".tsv" style="font-size:12px;margin:0 0 0 4px;width:319px;" onchange="subAddFile(this.id,'_TA04',1);"/>
				<textarea id="_TA04" class="_editTextBox" wrap="off" style="height:250px;width:437px;" onchange="$HeightGraph_ElevationCash=[];" placeholder="[Tab]区切り／UTF-8N&#13;&quot;//&quot; で始まる行はコメント行&#13;// 例 ※&quot;icon@画像ファイル&quot; はオプション&#13;35.68365900&#9;139.75408900&#9;皇居&#9;icon@画像ファイル"></textarea>
				<script>
					document.getElementById("_TA04").onkeydown = function(e){subAddTabCtrl(e, this);}
				</script>
				<div style="line-height:24px;">
					<input type="button" class="_btnNavi4" value="→住所から変換" onclick="subA2P_Geocoding('_TA04');"/>
					<input type="button" class="_btnNavi4" value="↑サンプル出力" onclick="subA2P_GeocodingSample('_TA04');"/>
					<a href="#" id="_btnDL" download="" onclick="subA2P_EditSave('_TA04')"><div class="_btnNavi2" style="display:inline-block;_display:">ファイルに保存</div></a>
					<input type="button" class="_btnNavi1" value="↑クリア" onclick="subA2P_EditInit('_TA04');"/>
					<br>
					<input type="button" class="_btnNavi3" value="←地図へ反映" onclick="subA2P_addToMap('_TA04');subA2P_DistMP('_TA04','_textDist',_checkboxDist.checked);"/>
					<input type="button" class="_btnNavi3" value="←クリア" onclick="subA2P_EditClear('_TA04','_GCircleM2P','_checkboxDist','_textDist');"/>
					<br>
					<input type="button" class="_btnNavi3" style="margin:0;padding:0 3px;" value="←" onclick="subA2P_GCircle('_GCircleM2P','_TA04');"/><input type="text" id="_GCircleM2P" class="_txtNavi1" list="_Dist" style="width:70px;" placeholder="範囲円"/>
					<datalist id="_Dist">
						<option value="50m"/><option value="100m"/><option value="250m"/><option value="500m"/><option value="1km"/><option value="2km"/><option value="4km"/><option value="5km"/><option value="8km"/><option value="10km"/><option value="20km"/><option value="25km"/><option value="40km"/><option value="50km"/><option value="80km"/><option value="100km"/>
					</datalist>
					<input type="checkbox" id="_checkboxDist" class="_checkboxNavi1" style="margin:0 0 0 4px;" onclick="subA2P_DistMP('_TA04','_textDist',_checkboxDist.checked);"/><input type="text" id="_textDist" class="_txtNavi2" style="width:90px;" placeholder="総距離" readonly/>
					<input type="button" id="_HgBtn" class="_btnNavi5" style="margin:0 0 0 4px;width:120px;" value="" onclick="subHeightGraphOpen();"/>
					<script>
						// 初期化
						document.getElementById("_HgBtn").value = $HeightGraph_Title + "ON";
					</script>
				</div>
			</div>
		</div>
		<!----------------------
		// Leaflet.greatCircle
		----------------------->
		<span id="_NC05" style="float:right;margin:0 4px;">
			<font class="_simpleWindowCall" onclick="subSimpleWindow_OpenClose('_SW05','_NC05');">距離円</font>
		</span>
		<div id="_SW05" class="_simpleWindow" style="width:268px;right:305px;">
			<font class="_simpleWindowTitle">半径&nbsp;</font><span id="$GCircleKm">0km</span>
			<font class="_simpleWindowClose" onclick="subSimpleWindow_OpenClose('_SW05','_NC05');">×</font>
			<div id="_GCircle" style="width:260px;"><input type="range" id="_GCircleRange" style="width:250px;" min="0" max="15000" value="0" oninput="subGCircle_Slider();"/></div>
		</div>
		<!---------
		// 海水面
		---------->
		<span id="_NC06" style="float:right;margin:0 4px;">
			<font class="_simpleWindowCall" onclick="subSimpleWindow_OpenClose('_SW06','_NC06');">海水面</font>
		</span>
		<div id="_SW06" class="_simpleWindow" style="right:359px;z-index:2000;">
			<font class="_simpleWindowTitle">ズーム14以下で利用可能</font>
			<font class="_simpleWindowClose" onclick="subSimpleWindow_OpenClose('_SW06','_NC06');">×</font>
			<div class="_simpleWindowOutput" style="padding:6px;">
				<input type="number" id="_Dem10ToSeaLevel1" value="0" style="text-align:right;width:45px;"/>～<input type="number" id="_Dem10ToSeaLevel2" value="10" style="text-align:right;width:55px;"/>ｍ
				<input type="button" class="_btnNavi1" value="ON" onclick="subDem10ToSeaLevel2('_Dem10ToSeaLevel1','_Dem10ToSeaLevel2');"/>
				<input type="button" class="_btnNavi2" value="OFF" onclick="$Dem10ToSeaLevel.remove($Map);"/>
			</div>
		</div>
	</div>
	<div id="_divMap">
		<script>
		// 地図描写調整
		subInitDisp();

		// URLからXYZ値を取得
		const hash = window.location.hash;

		if(hash.length){
			const aHash = hash.split("/");
			document.getElementById("_NaviZoom").value = aHash[0].substr(1); // 先頭の'#'より後
			document.getElementById("_NaviLat").value  = parseFloat(aHash[1]).toFixed(8);
			document.getElementById("_NaviLng").value  = parseFloat(aHash[2]).toFixed(8);
		}
		else{
			// 初回座標＠皇居
			document.getElementById("_NaviZoom").value = 5;
			document.getElementById("_NaviLat").value  = (35.68518697509636).toFixed(8);
			document.getElementById("_NaviLng").value  = (139.7522735595703).toFixed(8);

			// 現在座標取得
			navigator.geolocation.getCurrentPosition(
				function(position){
					document.getElementById("_NaviLat").value = position.coords.latitude.toFixed(8);
					document.getElementById("_NaviLng").value = position.coords.longitude.toFixed(8);
					_iwmBMN();
					_iwmCU();
					_iwmCM();
					subGCircle_Draw();
				},
				function(error){
					_iwmBMN();
					_iwmCU();
					_iwmCM();
					subGCircle_Draw();
				}
			);
		}

		// 【おまじない】複数のポップアップを許可（1.x対応）
		L.Map = L.Map.include(
			{
				openPopup:function(popup, latlng, options){
					if(latlng){
						popup.setLatLng(latlng);
					}
					if(this._popup && this._popup.options.autoClose){
						/// this.closePopup();
					}
					this._popup = popup;
					return this.addLayer(popup);
				}
			}
		);

		// 初回表示設定
		const $Map = L.map(
			"_divMap",
			{
				center:[document.getElementById("_NaviLat").value, document.getElementById("_NaviLng").value],
				zoom:document.getElementById("_NaviZoom").value,
				minZoom:3,  // 最小ズーム
				maxZoom:23, // 最大ズーム
				zoomControl:false, // Control.Zoom 非表示
				doubleClickZoom:false // DblClick制御
			}
		);

		/*---------------
		// スケール表示
		---------------*/
		L.control.scale(
			{
				metric:true,
				imperial:false,
				position:"bottomleft"
			}
		).addTo($Map);

		/*--------------------------
		// Leaflet.PolylineMeasure
		--------------------------*/
		const $PolylineMeasure = L.control.polylineMeasure(
			{
				position:"bottomleft",
				unit:"metres",
				showBearings:true,
				clearMeasurementsOnStop:false,
				showClearControl:true,
				showUnitControl:false
			}
		);
		$PolylineMeasure.addTo($Map);

		/*--------------------------------------------------------------------------------------
		// メニュー等で使用
		//   [0]'地図種', [1]'URL', [2]'拡張子', [3]'opacity', [4]'maxNativeZoom'
		//   (例) ["std", "https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png", 1.0, 18]
		// http://maps.gsi.go.jp/development/ichiran.html
		--------------------------------------------------------------------------------------*/
		const $URL = "https://cyberjapandata.gsi.go.jp/xyz/";

		/*---------------
		// ラジオボタン
		---------------*/
		let $RadioButtonSelectMap = [];

		let $RadioButtonMap = [];
			$RadioButtonMap.push(["標準地図", $URL + "std/{z}/{x}/{y}.png",   1.0, 18, "地理院タイル std"]);
			$RadioButtonMap.push(["淡色地図", $URL + "pale/{z}/{x}/{y}.png",  1.0, 18, "地理院タイル pale"]);
			$RadioButtonMap.push(["白地図"  , $URL + "blank/{z}/{x}/{y}.png", 1.0, 14, "地理院タイル blank"]);
			$RadioButtonMap.push(["なし", "", 0.0, 18]);

		for(let _a1 of $RadioButtonMap){
			$RadioButtonSelectMap[_a1[0]] = L.tileLayer(
				_a1[1],
				{
					attribution:_a1[4],
					opacity:_a1[2],
					maxNativeZoom:_a1[3],
					maxZoom:23
				}
			);
		}
		// 初期選択値
		$RadioButtonSelectMap[$RadioButtonMap[0][0]].addTo($Map);

		/*-----------------------
		// チェックボックス可変
		-----------------------*/
		let $LMapSelector = null;

		function subMapSelector(){
			let checkBoxSelectMap = [];
			const obj = document.getElementById("_TA02");

			if(obj.value.length == 0){
				obj.value = "// [Tab]区切り\n// タイル種\t拡張子\t透過率(0.1-1.0)\t最大ズーム\t表示名(省略可)\nseamlessphoto\tjpg\t0.5\t18\tシームレス写真／50%\nseamlessphoto\tjpg\t1.0\t18\tシームレス写真／100%\nrelief\tpng\t1.0\t15\t色別標高図\nslopezone1map\tpng\t1.0\t15\t全国傾斜量区分図\n";
			}

			let ary = [];

			for(let _s1 of document.getElementById("_TA02").value.trimEnd().split("\n")){
				_s1 = _s1.trim();

				if(_s1.length > 0 && _s1.substr(0, 2) != "//"){
					let _a1 = _s1.split("\t");

					// タイル種
					_a1[0] = _a1[0].trim();

					// 拡張子
					try{
						_a1[1] = _a1[1].trim();
						if(!_a1[1].length){
							throw null;
						}
					}
					catch(e){
						_a1[1] = "png";
					}

					// 透過率(0.1-1.0)
					try{
						_a1[2] = parseFloat(_a1[2]);
						if(isNaN(_a1[2])){
							throw null;
						}
					}
					catch(e){
						_a1[2] = 0.5;
					}

					// 最大ズーム
					try{
						_a1[3] = parseInt(_a1[3]);
						if(isNaN(_a1[3])){
							throw null;
						}
					}
					catch(e){
						_a1[3] = 18;
					}

					// 表示名(省略可)
					try{
						_a1[4] = _a1[4].trim();
						if(!_a1[4].length){
							throw null;
						}
					}
					catch(e){
						_a1[4] = _a1[0];
					}

					// attribution(省略可)
					try{
						_a1[5] = _a1[5].trim();
						if(!_a1[5].length){
							throw null;
						}
					}
					catch(e){
						_a1[5] = "地理院タイル " + _a1[0];
					}

					ary.push([_a1[0], ($URL + _a1[0] + "/{z}/{x}/{y}." + _a1[1]), _a1[2], _a1[3], _a1[4], _a1[5]]);
				}
			}

			// 追加タイル
			ary.push([
				"シームレス地質図／30%",
				"https://gbank.gsj.jp/seamless/v2/api/1.2/tiles/{z}/{y}/{x}.png",
				0.3,
				13,
				"",
				"20万分の1日本シームレス地質図V2@<a href='https://gbank.gsj.jp/seamless/v2.html' target='_blank'>産総研地質調査総合センターウェブサイト</a>"
			]);
			ary.push([
				"シームレス地質図／80%",
				"https://gbank.gsj.jp/seamless/v2/api/1.2/tiles/{z}/{y}/{x}.png",
				0.8,
				13,
				"",
				"20万分の1日本シームレス地質図V2@<a href='https://gbank.gsj.jp/seamless/v2.html' target='_blank'>産総研地質調査総合センターウェブサイト</a>"
			]);
			ary.push([
				"UTMグリッド",
				"http://{s}.tile.stamen.com/utm/{z}/{x}/{y}.png",
				1.0,
				23,
				"",
				"Map tiles by <a href='http://stamen.com' target='_blank'>Stamen Design</a>, under <a href='http://creativecommons.org/licenses/by/3.0' target='_blank'>CC BY 3.0</a>."
			]);

			for(let _a1 of ary){
				if(!_a1[4].length){
					_a1[4] = _a1[0];
				}
				checkBoxSelectMap[_a1[4]] = L.tileLayer(
					_a1[1],
					{
						attribution:_a1[5],
						opacity:_a1[2],
						maxNativeZoom:_a1[3],
						maxZoom:23
					}
				);
			}

			/*-----------------
			// 経緯度グリッド
			-----------------*/
			checkBoxSelectMap["経緯度グリッド"] = L.latlngGraticule(
				{
					color:"#003",
					font:"16px sans-serif",
					latLineCurved:0,
					lngLineCurved:0,
					opacity:1.0,
					showLabel:true,
					weight:0.6,
					zoomInterval:[
						{
							start:0,
							end:5,
							interval:5
						},
						{
							start:6,
							end:23,
							interval:1
						}
					]
				}
			);

			/*------------------------
			// 標準地図等を色調変換
			------------------------*/
			/*【参考】
				http://sterfield.co.jp/designer/canvas%E3%81%A7%E7%94%BB%E5%83%8F%E3%81%AE%E7%99%BD%E3%82%92%E9%80%8F%E9%81%8E%E3%81%AB%E3%81%99%E3%82%8B/
			*/
			// 標準 => 明色
			const $StdToBright = new L.GridLayer();
			$StdToBright.createTile = function(coords){
				const tile = L.DomUtil.create("canvas", "leaflet-tile");
					tile.width = tile.height = 256;
				const ctx = tile.getContext("2d");
				const img = new Image();
					img.crossOrigin = "anonymous";
					// leafletが使うタイルと別のサーバ（https／http）にアクセスし、Access-Control-Allow-Originを回避
					img.src = "https://cyberjapandata.gsi.go.jp/xyz/std/" + coords.z + "/" + coords.x + "/" + coords.y + ".png";
				img.onload = function(){
					ctx.drawImage(this, 0, 0);
					const rtnImg = ctx.getImageData(0, 0, 256, 256);
					let rtnImgData = rtnImg.data;
					// 画像加工
					for(let _i1 = 0; _i1 < 256 * 256 * 4; _i1+=4){
						if(rtnImgData[_i1 + 0] > 160 && rtnImgData[_i1 + 1] > 160 && rtnImgData[_i1 + 2] > 160){
							rtnImgData[_i1 + 3] = 0;
						}
						else{
							rtnImgData[_i1 + 3] = 255;
						}
					}
					ctx.putImageData(rtnImg, 0, 0);
				}
				return tile;
			}

			// 標準 => 褐色
			const $StdToBrown = new L.GridLayer();
			$StdToBrown.createTile = function(coords){
				const tile = L.DomUtil.create("canvas", "leaflet-tile");
					tile.width = tile.height = 256;
				const ctx = tile.getContext("2d");
				const img = new Image();
					img.crossOrigin = "anonymous";
					// leafletが使うタイルと別のサーバ（https／http）にアクセスし、Access-Control-Allow-Originを回避
					img.src = "https://cyberjapandata.gsi.go.jp/xyz/std/" + coords.z + "/" + coords.x + "/" + coords.y + ".png";
				img.onload = function(){
					ctx.drawImage(this, 0, 0);
					const rtnImg = ctx.getImageData(0, 0, 256, 256);
					let rtnImgData = rtnImg.data;
					// 画像加工
					for(let _i1 = 0; _i1 < 256 * 256 * 4; _i1+=4){
						// 各カラーチャンネルで、一番暗い値を取得
						let minLuminance = rtnImgData[_i1];
						if(minLuminance > rtnImgData[_i1 + 1]){
							minLuminance = rtnImgData[_i1 + 1];
						}
						if(minLuminance > rtnImgData[_i1 + 2]){
							minLuminance = rtnImgData[_i1 + 2];
						}
						// 減色
						rtnImgData[_i1 + 0] -= minLuminance;
						rtnImgData[_i1 + 1] -= minLuminance;
						rtnImgData[_i1 + 2] -= minLuminance;
						// 一番暗い値をアルファチャンネルに反映(明るいところほど透明に)
						rtnImgData[_i1 + 3] = 255 - minLuminance;
					}
					ctx.putImageData(rtnImg, 0, 0);
				}
				return tile;
			}

			// 標準 => 黒色
			const $StdToBlack = new L.GridLayer();
			$StdToBlack.createTile = function(coords){
				const tile = L.DomUtil.create("canvas", "leaflet-tile");
					tile.width = tile.height = 256;
				const ctx = tile.getContext("2d");
				const img = new Image();
					img.crossOrigin = "anonymous";
					// leafletが使うタイルと別のサーバ（https／http）にアクセスし、Access-Control-Allow-Originを回避
					img.src = "https://cyberjapandata.gsi.go.jp/xyz/pale/" + coords.z + "/" + coords.x + "/" + coords.y + ".png";
				img.onload = function(){
					ctx.drawImage(this, 0, 0);
					const rtnImg = ctx.getImageData(0, 0, 256, 256);
					let rtnImgData = rtnImg.data;
					// 画像加工
					for(let _i1 = 0; _i1 < 256 * 256 * 4; _i1+=4){
						if(rtnImgData[_i1 + 0] >= 200 && rtnImgData[_i1 + 1] >= 200 && rtnImgData[_i1 + 2] >= 200){
							rtnImgData[_i1 + 3] = 0;
						}
						else{
							rtnImgData[_i1 + 0] = 0;
							rtnImgData[_i1 + 1] = 0;
							rtnImgData[_i1 + 2] = 0;
							rtnImgData[_i1 + 3] = 255;
						}
					}
					ctx.putImageData(rtnImg, 0, 0);
				}
				return tile;
			}

			/*-------------
			// タイル座標
			-------------*/
			const $TileCoord = new L.GridLayer();
			$TileCoord.createTile = function(coords){
				const tile = L.DomUtil.create("canvas", "leaflet-tile");
					tile.width = tile.height = 256;
				const tileText = coords.z + "-" + coords.x + "-" + coords.y;
				const ctx = tile.getContext("2d");
					// 枠線
					ctx.lineWidth = 1;
					ctx.strokeStyle = "#000";
					ctx.strokeRect(0, 0, 255, 255);
					// 文字
					ctx.font = "24px Arial";
					ctx.textAlign = "center";
					ctx.lineWidth = 6.0;
					ctx.strokeStyle = "#fff";
					ctx.strokeText(tileText, 128, 128);
					// 文字ヌキ
					ctx.fillStyle = "#88f";
					ctx.fillText(tileText, 128, 128);
				return tile;
			};

			// 追加メニュー
			checkBoxSelectMap["注記／明色 [-z18]"] = $StdToBright;
			checkBoxSelectMap["注記／褐色 [-z18]"] = $StdToBrown;
			checkBoxSelectMap["注記／黒色 [-z18]"] = $StdToBlack;
			checkBoxSelectMap["海水面 [-z14]"] = $Dem10ToSeaLevel;
			checkBoxSelectMap["タイル座標"] = $TileCoord;

			/*-------------------
			// 地図選択メニュー
			-------------------*/
			if($LMapSelector){
				$Map.removeControl($LMapSelector); // 前出を削除
			}
			$LMapSelector = L.control.layers(
				$RadioButtonSelectMap,
				checkBoxSelectMap,
				{
					position:"topright"
				}
			);
			$LMapSelector.addTo($Map);

			// 初回表示の処理
			$Map.on(
				"overlayremove",
				function(e){
					// 地図選択メニューから削除
					checkBoxSelectMap[e.name].remove($Map);
				}
			);
		}
		subMapSelector();

		// 座標マーカー
		const $BaseMarkerIcon = L.AwesomeMarkers.icon(
			{
				icon:"home",
				prefix:"fa",
				markerColor:"darkblue",
				spin:false
			}
		);
		const $LocalMarkerDragOn = L.AwesomeMarkers.icon(
			{
				icon:"flag",
				prefix:"fa",
				markerColor:"darkred",
				spin:false
			}
		);
		const $LocalMarkerDragOff = L.AwesomeMarkers.icon(
			{
				icon:"thumb-tack",
				prefix:"fa",
				markerColor:"orange",
				spin:false
			}
		);
		/*-----------------------------
		// マーカーのポップアップ更新
		-----------------------------*/
		function subMarkerPopup(
			$BaseMarker,
			$AryLocalMarker
		){
			// ベースマーカー
			$BaseMarker.closePopup();

			subLatLngToPlaceName(
				$BaseMarker._latlng.lat,
				$BaseMarker._latlng.lng,
				$BaseMarker,
				null
			);

			$BaseMarker.bindPopup(
				rtnMarkerPopup1(
					$BaseMarker._latlng.lat,
					$BaseMarker._latlng.lng
				),
				{
					autoPan:false // ポップアップ時、表示調整しない
				}
			);
			$BaseMarker.openPopup();

			// ローカルマーカー
			for(let _s1 of $AryLocalMarker){
				_s1.closePopup();
				_s1.bindPopup(
					rtnMarkerPopup2(
						$BaseMarker._latlng.lat,
						$BaseMarker._latlng.lng,
						_s1._latlng.lat,
						_s1._latlng.lng,
						_s1
					),
					{
						autoPan:false // ポップアップ時、表示調整しない
					}
				);
				_s1.openPopup();
			}
		}
		/*---------------------
		// ベースマーカー描画
		---------------------*/
		let $BaseMarker = null;
		let $AryLocalMarker = [];

		function subBaseMarkerNew(
			$Lat,
			$Lng
		){
			for(let _i1 = 0, _i2 = arguments.length; _i1 < _i2; _i1++){
				if(isNaN(arguments[_i1])){
					arguments[_i1] = document.getElementById(arguments[_i1]).value;
				}
			}
			if($BaseMarker){
				$BaseMarker.remove($Map);
			}
			$BaseMarker = L.marker(
				[$Lat, $Lng],
				{
					icon:$BaseMarkerIcon,
					draggable:true // ドラッグ許可
				}
			).addTo($Map);

			$BaseMarker.elevation = "-----";

			// URL／BL表示を変更
			subChangeUrl($Lat, $Lng, "_NaviZoom");

			// ズームレベル変更 <= click
			$BaseMarker.on(
				"click",
				function(e){
					// ズームレベル補完
					const mouseP = $Map.latLngToContainerPoint(this.getLatLng());
					subIwmInput_ZoomA_Open(
						"_NaviZoom",
						(mouseP.x + 30),
						(mouseP.y - 40)
					);
				}
			);
			// 全ポップアップ表示 <= contextmenu
			$BaseMarker.on(
				"contextmenu",
				function(e){
					this.closePopup();
					subMarkerPopup($BaseMarker, $AryLocalMarker);
					let i1 = $AryPoint.length;
					while(i1--){
						$AryPoint[i1].openPopup();
					}
				}
			);
			// ポップアップ情報更新 <= dragend
			$BaseMarker.on(
				"dragend",
				function(e){
					// URL／BL表示を変更
					const a1 = this.getLatLng();

					subChangeUrl(a1.lat, a1.lng, "_NaviZoom");

					// "_InputBL" を更新
					_iwmIBL($subIwmInput_BL_toSave);

					// 表示を更新して、すぐに隠す
					subMarkerPopup($BaseMarker, $AryLocalMarker);

					this.closePopup();
				}
			);
			// 何もしない <= mouseover
			$BaseMarker.on(
				"mouseover",
				function(e){
					// 先読みしておく
					rtnMarkerPopup1($BaseMarker._latlng.lat, $BaseMarker._latlng.lng);
				}
			);
		}

		// ベースマーカー初回描画
		_iwmBMN();

		// ズームバー
		subIwmInput_Zoom_Change($Map.getZoom());

		// ミニマップ
		const miniMapLayer = new L.TileLayer(
			"https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",
			{
				minZoom:3,
				maxZoom:18
			}
		);
		new L.Control.MiniMap(
			miniMapLayer,
			{
				toggleDisplay:true
			}
		).addTo($Map);

		/*-----------------
		// 右クリック共通
		-----------------*/
		function subMapOnRClick(
			$lat,
			$lng,
			$placeName
		){
			let bIconDrag = false;
			if(!$placeName){
				bIconDrag = true;
			}

			// マーカー作成
			$AryLocalMarker.push(
				L.marker(
					[$lat, $lng],
					{
						icon:(bIconDrag ? $LocalMarkerDragOn : $LocalMarkerDragOff),
						draggable:bIconDrag
					}
				).addTo($Map)
			);

			$AryLocalMarker[$AryLocalMarker.length - 1].elevation = "-----";

			// [マーカー消去]ボタン表示
			subMyObj_OnOff($AryLocalMarker);

			// 現在(配列)のローカルマーカー
			const obj = $AryLocalMarker[$AryLocalMarker.length - 1];

			// 緯度経度から地名を検索
			subLatLngToPlaceName(
				$lat,
				$lng,
				obj,
				(bIconDrag ? null : $placeName)
			);

			// 固定点地名のときだけセンタリング
			if(!bIconDrag){
				$Map.setView(
					[$lat, $lng],
					document.getElementById("_NaviZoom").value
				);
			}

			// ズームレベル補完 <= click
			obj.on(
				"click",
				function(e){
					// ズームレベル補完
					$iwmCM_hash = this.getLatLng();
					const mouseP = $Map.latLngToContainerPoint($iwmCM_hash);
					subIwmInput_ZoomA_Open(
						"_NaviZoom",
						(mouseP.x + 20),
						(mouseP.y - 25)
					);
				}
			);
			// マーカー消去 <= contextmenu
			obj.on(
				"contextmenu",
				function(e){
					let i1 = $AryLocalMarker.length;
					while(i1--){
						if(this == $AryLocalMarker[i1]){
							// マーカー消去
							$AryLocalMarker[i1].remove($Map);
							// 配列から削除
							$AryLocalMarker.splice(i1, 1);
							break;
						}
					}
					// [マーカー消去]ボタン非表示
					subMyObj_OnOff($AryLocalMarker);
					// 距離円再描画
					subGCircle_Draw();
				}
			);
			// ドラッグ <= dragend
			obj.on(
				"dragend",
				function(e){
					// 先読みしておく
					rtnMarkerPopup2(
						$BaseMarker._latlng.lat,
						$BaseMarker._latlng.lng,
						this._latlng.lat,
						this._latlng.lng,
						this
					);
				}
			);
			// ポップアップ表示更新 <= mouseover
			obj.on(
				"mouseover",
				function(e){
					// 先読みしておく
					rtnMarkerPopup2(
						$BaseMarker._latlng.lat,
						$BaseMarker._latlng.lng,
						this._latlng.lat,
						this._latlng.lng,
						this
					);
				}
			);
			// ポップアップ再表示 <= mouseout
			obj.on(
				"mouseout",
				function(e){
					this.closePopup();
					this.bindPopup(
						rtnMarkerPopup2(
							$BaseMarker._latlng.lat,
							$BaseMarker._latlng.lng,
							this._latlng.lat,
							this._latlng.lng,
							this
						),
						{
							autoPan:false // ポップアップ時、表示調整しない
						}
					);
					this.openPopup();
				}
			);
		}

		/*---------------------
		// 地図上イベント共通
		---------------------*/
		// マーカー毎のイベント設定後でないと不具合
		$Map.on(
			"dblclick",
			function(e){
				// ズームレベル補完
				subIwmInput_ZoomA_Open(
					"_NaviZoom",
					(e.containerPoint.x + 20),
					(e.containerPoint.y - 25)
				);
				// ベースマーカー再描画
				subBaseMarkerNew(e.latlng.lat, e.latlng.lng);
				// 距離円再描画
				subGCircle_Draw();
			}
		);
		$Map.on(
			"contextmenu",
			function(e){
				subMapOnRClick(e.latlng.lat, e.latlng.lng, null);
				// 距離円再描画
				subGCircle_Draw();
			}
		);
		$Map.on(
			"zoomend",
			function(e){
				// URL／BL表示を変更
				subChangeUrl("_NaviLat", "_NaviLng", $Map.getZoom());
				// ズームバー
				subIwmInput_Zoom_Change($Map.getZoom());
			}
		);
		</script>
	</div>
</body>

</html>

<!---------------------
// ヒアドキュメント風
---------------------->
<textarea id="_HDoc01" style="display:none;">
<style>
._div_head{background:#ffc;color:#000;margin:8px 4px 4px 4px;padding:0 8px;font-weight:600;}
._ol, ._ul{margin:0;padding:0;}
._li1, ._li2{padding:0 0 2px 0;}
._li1{margin:0 0 0 24px;}
._li2{margin:0 0 0 8px;}
._font_size22px{font-size:22px;}
._font_color1{color:#3d7cce;}
._font_color2{color:#bd1e38;}
._font_color3{color:#fb9d3e;}
</style>
<div class="_div_head">地図上でのマウス操作</div>
 <ul class="_ul">
  <li class="_li1">ダブルクリック：<font class="_font_color1">青マーカー<i class="fa fa-map-marker _font_size22px"></i></font>&nbsp;移動</li>
  <li class="_li1">左クリック：全ポップアップ&nbsp;非表示</li>
  <li class="_li1">右クリック：<font class="_font_color2">赤マーカー<i class="fa fa-map-marker _font_size22px"></i></font>&nbsp;追加</li>
 </ul>
<div class="_div_head">マーカー上でのマウス操作</div>
 <ol class="_ol">
  <li class="_li1"><font class="_font_color1">青マーカー<i class="fa fa-map-marker _font_size22px"></i></font>
   <ul class="_ul">
    <li class="_li2">左クリック：ズームレベル</li>
    <li class="_li2">右クリック：全ポップアップ<font class="_font_size22px"><i class="fa fa-commenting-o _font_color1"></i><i class="fa fa-commenting-o _font_color2"></i><i class="fa fa-commenting-o _font_color3"></i></font></li>
    <li class="_li2">ドラッグ：移動</li>
    <li class="_li2">マウスオーバー：何もしない</li>
   </ul>
  </li>
  <li class="_li1"><font class="_font_color2">赤マーカー<i class="fa fa-map-marker _font_size22px"></i></font>
   <ul class="_ul">
    <li class="_li2">左クリック：ズームレベル</li>
    <li class="_li2">右クリック：消去</li>
    <li class="_li2">ドラッグ：移動</li>
    <li class="_li2">マウスオーバー：ポップアップ<font class="_font_size22px"><i class="fa fa-commenting-o _font_color2"></i></font></li>
   </ul>
  </li>
  <li class="_li1"><font class="_font_color3">オレンジマーカー<i class="fa fa-map-marker _font_size22px"></i></font>
   <ul class="_ul">
    <li class="_li2">左クリック：ズームレベル</li>
    <li class="_li2">右クリック：消去</li>
    <li class="_li2">ドラッグ：何もしない</li>
    <li class="_li2">マウスオーバー：ポップアップ<font class="_font_size22px"><i class="fa fa-commenting-o _font_color3"></i></font></li>
   </ul>
  </li>
 </ol>
</li>
</textarea>
<script>
	// 初期化
	document.getElementById("_SW01Doc").innerHTML = document.getElementById("_HDoc01").value;
</script>
