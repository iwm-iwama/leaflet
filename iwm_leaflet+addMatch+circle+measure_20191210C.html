<!-- Ver.20191223_1351 'U-2S' -->

<!DOCTYPE html>
<html lang="ja">

<head>
<meta charset="UTF-8"/>
<meta http-equiv="Content-Script-Type" content="text/javascript">
<title>地理院タイル・簡易ビュアー</title>

<!-- ライブラリ開発諸氏に敬意を表す -->

<!--------------------------------------------------------------------
// leaflet
--------------------------------------------------------------------->
<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"></script>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"/>

<!--------------------------------------------------------------------
// Control.MiniMap
--------------------------------------------------------------------->
<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-minimap/3.6.1/Control.MiniMap.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet-minimap/3.6.1/Control.MiniMap.css"/>

<!--------------------------------------------------------------------
// leaflet.awesome-markers.min
--------------------------------------------------------------------->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css"/>

<!--------------------------------------------------------------------
// font-awesome
--------------------------------------------------------------------->
<link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.css"/>

<!--------------------------------------------------------------------
// Leaflet.PolylineMeasure
--------------------------------------------------------------------->
<script src="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.js"></script>
<link rel="stylesheet" href="https://ppete2.github.io/Leaflet.PolylineMeasure/Leaflet.PolylineMeasure.css"/>

<!--------------------------------------------------------------------
// Leaflet.greatCircle
--------------------------------------------------------------------->
<script src="https://nuclearsecrecy.github.io/Leaflet.greatCircle/Leaflet.greatCircle.js"></script>

<!--------------------------------------------------------------------
// CSS
--------------------------------------------------------------------->
<style>
@charset "utf-8";

/*-------
// 共通
-------*/
*
{
	font-family:sans-serif;
	margin:0;
	padding:0;
}
/*------------------
// leaflet CSS置換
------------------*/
.leaflet-popup-content-wrapper,
.leaflet-popup-tip
{
	background:#fff;
	border-color:#404040;
	-webkit-border-radius:3px !important;
	-moz-border-radius:3px !important;
	border-radius:3px !important;
}
.leaflet-popup-content,
.leaflet-popup-close-button
{
	color:#303030 !important;
	font:11px Sans-serif;
	line-height:14px;
	margin:0;
	padding:2px 5px;
}
.leaflet-container
{
	background:#fff;
}
#map
{
	position:absolute;
	top:0;
	left:0;
	width:100%;
	height:100%;
	margin:0;
	padding:0;
}
/*-------------------
// 本スクリプト関係
-------------------*/
body
{
	background:#f6f6f7;
	margin:0;
	padding:0;
}
/*-------
// 共通
-------*/
select
{
	background:#fff;
	border:0;
	cursor:pointer;
	font-size:11px;
	height:19px;
	margin:0 0 0 8px;
	padding:0;
	width:80px;
}
select:hover
{
	background:#ff5 !important;
}
option
{
	background:#fff;
	font-size:14px;
	margin:0 0 0 4px;
	padding:4px;
}
._btnNavi1,
._btnNavi2,
._btnNavi3,
._btnNavi4
{
	border:0;
	color:#fff;
	font-size:12px;
	margin:0;
	padding:0 8px;
	text-decoration:none;
}
._btnNavi1:hover,
._btnNavi2:hover,
._btnNavi3:hover,
._btnNavi4:hover
{
	cursor:pointer;
}
._btnNavi1
{
	background:#3d7cce;
}
._btnNavi1:hover
{
	background:#6dacff !important;
}
._btnNavi2
{
	background:#bd1e38;
}
._btnNavi2:hover
{
	background:#ed4e68 !important;
}
._btnNavi3
{
	background:#2dae6c;
}
._btnNavi3:hover
{
	background:#3dce7c !important;
}
._btnNavi4
{
	background:#855896;
}
._btnNavi4:hover
{
	background:#955aa6 !important;
}
/*---------------
// 上部メニュー
---------------*/
#_divNaviCommander
{
	background:#505050;
	border:0;
	border-radius:8px 8px 0 0;
	color:#fff;
	font-size:14px;
	line-height:18px;
	left:0;
	margin:0;
	padding:2px 4px 2px 10px;
	position:absolute;
	top:0;
	/* 動的に変更 */
	width:0;
}
#_divMap
{
	cursor:crosshair;
	left:0;
	position:absolute;
	top:24px;
	/* 動的に変更 */
	height:0;
	width:0;
}
#_InputNum,
#_InputBL,
#_InputZoomA,
#_InputZoomB
{
	background-color:rgba(255, 255, 255, 0.6);
	border:1px solid #777;
	font-size:12px;
	margin:0;
	padding:2px;
	position:absolute;
	z-index:2000;
}
#_InputNum,
#_InputBL,
#_InputZoomA
{
	top:-1000px;/* フォーマット時に隠すため */
}
#_InputZoomB
{
	/* 以下、必要に応じて修正 */
	left:12px;
	top:37px;
}
/* ↓OverLap */
#_InputNum,
#_InputBL
{
	text-align:left;
	width:120px;
}
#_InputZoomA
{
	text-align:center;
	width:150px;
}
#_InputZoomB
{
	border:0;
	margin:0;
	padding:0;
	text-align:center;
}
/* ↑OverLap */
._Btn1,
._Btn2,
._Btn3,
._ZA,
._ZB
{
	border:0;
	color:#fff;
	cursor:pointer;
	font-size:12px;
	line-height:0;
	margin:2px;
	padding:0;
}
/* ↓OverLap */
._Btn1,
._ZA,
._ZB
{
	background-color:rgba(0, 0, 0, 0.6);
}
._Btn1:hover,
._ZA:hover,
._ZB:hover
{
	background:#3c7bff !important;
}
._Btn2
{
	background-color:rgba(12, 75, 157, 0.8);
}
._Btn2:hover
{
	background:#3c7bff !important;
}
._Btn3
{
	background-color:rgba(229, 72, 72, 0.9);
}
._Btn3:hover
{
	background:#ff5858 !important;
}
#_InputNum > ._Btn1,
#_InputNum > ._Btn2,
#_InputNum > ._Btn3,
#_InputBL  > ._Btn1,
#_InputBL  > ._Btn2,
#_InputBL  > ._Btn3
{
	height:23px;
	width:36px;
}
._ZB
{
	margin:0;
}
#_InputZoomA > ._ZA,
#_InputZoomA > ._Btn3,
#_InputZoomB > ._ZB
{
	height:26px;
	width:26px;
}
#_IBL1,
#_IBL2,
#_IBL3
{
	background:#fff;
	border:1px solid #000;
	color:#000;
	cursor:text;
	height:16px;
	ime-mode:inactive;
	margin:1px 2px;
	padding:0 2px;
	text-align:left;
}
#_IBL1:hover,
#_IBL2:hover,
#_IBL3:hover,
#_IBL1:focus,
#_IBL2:focus,
#_IBL3:focus
{
	background:#ff5 !important;
}
/* ↑OverLap */
#_NaviZoom,
#_NaviNum,
#_NaviLat,
#_NaviLng
{
	border:0;
	font-size:12px;
	ime-mode:inactive;
	margin:0;
	padding:0 3px;
}
#_NaviNum
{
	width:80px;
}
#_NaviLat,
#_NaviLng
{
	width:100px;
}
#_NaviZoom:hover,
#_NaviNum:hover,
#_NaviLat:hover,
#_NaviLng:hover,
#_NaviZoom:focus,
#_NaviNum:focus,
#_NaviLat:focus,
#_NaviLng:focus
{
	background:#ff5 !important;
}
/*---------------------
// アドレスマッチング
---------------------*/
#_AddMatchInput
{
	background:#3d7cce;
	border:0;
	line-height:14px;
	margin:0;
	padding:0;
	position:absolute;
	z-index:1000;
	/* 以下、必要に応じて修正 */
	left:52px;
	top:37px;
}
#_AddMatchInput1
{
	background:#fff;
	border:1px solid #000;
	color:#000;
	cursor:text;
	font-size:14px;
	height:18px;
	ime-mode:inactive;
	margin:0;
	padding:0 3px;
	width:100px;
}
#_AddMatchInput1:hover
{
	background:#ff0 !important;
}
#_AddMatchInput2
{
	color:#fff;
	font-size:14px;
	font-weight:500;
	margin:0;
	padding:0 3px;
}
#_AddMatchInput3
{
	color:#fff;
	font-size:16px;
	font-weight:900;
	margin:0;
	padding:0 2px 0 0;
}
#_AddMatchInput2:hover,
#_AddMatchInput3:hover
{
	color:#f00;
	cursor:pointer;
}
#_AddMatchOutput
{
	background-color:rgba(255, 255, 255, 0.3);
	border:0;
	box-shadow:0 0 2px #000;
	color:#000;
	font-size:13px;
	left:0;
	margin:2px 0 0 2px;
	overflow:auto;
	position:absolute;
	top:-1000px;/* フォーマット時に隠すため */
	z-index:999;
	/* 以下、必要に応じて修正 */
	max-height:480px;
	padding:6px;
	width:220px;
}
#_AddMatchOutput:hover
{
	background:#fff !important;
}
#_AddMatchOutputH
{
	color:#00d;
	padding:0 0 4px 0;
}
#_AddMatchOutputF
{
	padding:4px 0;
	text-align:center;
}
#_AddMatchOutput1
{
	color:#000;
	font-size:14px;
	line-height:14px;
	margin:0;
	padding:6px 4px;
}
#_AddMatchOutput1:hover
{
	background:#ff0 !important;
}
._AddMatchRem
{
	color:#f00;
	font-size:11px;
}
/*-------------
// 距離円作成
-------------*/
#_GCircle
{
	background-color:rgba(0, 0, 0, 0.6);
	color:#fff;
	font-size:8pt;
	padding:0 0 0 8px;
	position:absolute;
	top:37px;
	right:74px;
	width:250px;
	z-index:1000;
}
/*----------------
// Simple Window
----------------*/
._simpleWindowCall
{
	border:solid 1px #fff;
	color:#fff;
	font-size:13px;
	font-weight:500;
	float:right;
	margin:0;
	padding:0 4px;
}
._simpleWindowCall:hover
{
	color:#f00;
	cursor:pointer;
}
._simpleWindow
{
	background:#0d4c9e;
	color:#fff;
	float:right;
	font-size:10px;
	line-height:14px;
	margin:0;
	padding:0;
	position:absolute;
	text-align:center;
	z-index:2000;
	/* 以下、必要に応じて修正 */
	right:0;
	top:24px;
}
._simpleWindowTitle
{
	display:;/* 不使用のとき"none"を代入 */
	margin:0;
	padding:0;
}
._simpleWindowClose
{
	float:right;
	font-size:16px;
	font-weight:900;
	padding:0 3px 0 0;
}
._simpleWindowClose:hover
{
	color:#f00;
	cursor:pointer;
}
._simpleWindowOutput
{
	background:#fff;
	border:0;
	color:#000;
	font-size:13px;
	line-height:14px;
	margin:1px;
	overflow:auto;
	padding:16px 0;
	text-align:left;
}
/*---------------
// Edit Textbox
---------------*/
._editTextBox
{
	border:2px solid #fa0;
	color:#000;
	font-size:13px;
	ime-mode:inactive;
	margin:0;
	overflow:auto;
	padding:2px 6px;
	resize: none;
}
._editTextBox:focus,
._editTextBox:hover
{
	background:#ffa;
}
/*-----------
// 距離測定
-----------*/
.leaflet-control
{
	cursor:pointer;
}
a.polyline-measure-controlOnBgColor,
a.polyline-measure-controlOnBgColor:hover
{
	background-color:#5f5;
}
.polyline-measure-unicode-icon
{
	font-size:19px;
	font-weight:bold;
}
a.polyline-measure-clearControl:active {
	background-color:#f00;
}
.polyline-measure-tooltip
{
	background-color:rgba(0, 0, 0, 0.7);
	border-radius:3px;
	box-shadow:none;
	font-style:normal;
	height:auto !important;
	margin:0;
	padding:1px 4px 2px 4px;
	text-align:right;
	white-space:nowrap;
	width:auto !important;
}
.polyline-measure-tooltip-end
{
	background-color:rgba(0, 0, 0, 0.7);
}
.polyline-measure-tooltip-difference
{
	color:#f00;
	font:11px sans-serif;
	font-style:normal;
	font-weight:bold;
	line-height:12px;
}
.polyline-measure-tooltip-total
{
	color:#fff;
	font:13px sans-serif;
	font-style:normal;
	font-weight:normal;
	line-height:12px;
}
.polyline-measure-popupTooltip
{
	color:#f00;
	font:12px sans-serif;
	font-weight:bold;
	line-height:14px;
	margin:0;
	padding:4px;
}
</style>

<script>
	// muni.js を使うためのおまじない
	var GSI = {ClientMode:{}, Modal:{}, Draw:{}, Edit:{}, Control:{}, Utils:{Browser:{}}, GLOBALS:{}, TEXT:{}};
</script>
<script type="text/javascript" src="https://maps.gsi.go.jp/js/muni.js"></script>

<script>
/*-----------------------
// フレームサイズを調整
-----------------------*/
var $IsMSIE = 0;

function subInitDisp(){
	var mapH = 0;
	var mapW = 0;

	// WebBrowserは？
	//   Opera ?
	if(window.opera){
		mapH = window.innerHeight;
		mapW = window.innerWidth;
	}
	else if(document.all){
		with(window.document.documentElement){
			mapH = clientHeight;
			mapW = clientWidth;
		}
	}
	else if(document.getElementById){
		mapH = window.innerHeight;
		mapW = window.innerWidth;
	}

	// MSIE ?
	var uA = window.navigator.userAgent.toLowerCase();
	if(uA.indexOf("msie") != -1 || uA.indexOf("trident") != -1){
		if($IsMSIE == 0){
			++$IsMSIE;
			alert("このブラウザでは正しく表示されません\n\n【動作確認済】\n・Firefox\n・Google Chrome\n・Microsoft Edge");
		}
	}

	/*-------------
	// style 作成
	-------------*/
	// _divNaviCommander
	var obj1 = document.getElementById("_divNaviCommander").style;
	with(obj1){
		width = (mapW - 14) + "px";
	}

	// _divMap
	var obj2 = document.getElementById("_divMap").style;
	with(obj2){
		height = (mapH - 24) + "px";
		width  = mapW + "px";
	}

	obj1 = obj2 = null;
}
/*---------------
// 数値入力補完
---------------*/
// 大域変数
var $IwmInput_ctrlId = null;
var $IwmInputBL_saveId = null;
var $IwmInputZoom_value = null;
/*
const $AryIwmInput = ["_InputNum", "_InputBL"];
*/
const $AryIwmInput = ["_InputBL"];
function subIwmInput_init(){
	var i1 = 0;
	var i2 = $AryIwmInput.length;
	for(; i1 < i2; i1++){
		subIwmInput_close($AryIwmInput[i1]);
	}
}
function subIwmInputZoomA_open(
	$outputId, // [id]
	$posX,     // INT
	$posY      // INT
){
	subIwmInput_open("_InputZoomA", $outputId, $posX, $posY, true);
}
function subIwmInputZoomA_close(){
	subIwmInput_close("_InputZoomA");
}
function subIwmInputZoom_change(
	$str
){
	// 変更前を記憶
	$IwmInputZoom_value = document.getElementById("_NaviZoom").value = parseInt($str, 10);

	var Color1 = "#000";
	var Color2 = "#0c4b9d";

	var obj1 = document.getElementsByClassName("_ZA");
	var obj2 = document.getElementsByClassName("_ZB");

	var i1 = $str;
	var i2 = 0;
	var i3 = obj1.length;
	for(; i2 < i3; i2++){
		obj1[i2].style.background = (i1 == obj1[i2].value ? Color2 : Color1);

		if(i1 == obj1[i2].value){
			obj1[i2].style.background = Color2;
			obj1[i2].style.opacity = 0.8;
		}
		else{
			obj1[i2].style.background = Color1;
			obj1[i2].style.opacity = 0.6;
		}

		if(i1 == obj2[i2].value){
			obj2[i2].style.background = Color2;
			obj2[i2].style.opacity = 0.8;
		}
		else{
			obj2[i2].style.background = Color1;
			obj2[i2].style.opacity = 0.6;
		}
	}
	obj1 = obj2 = null;

	subIwmInput_close("_InputZoomA");
}
/*
function subIwmInputNum_open(
	$outputId // [id]
){
	$IwmInput_ctrlId = $outputId;
	subIwmInput_init();
	subIwmInput_open("_InputNum", $outputId, null, null, false);
}
function subIwmInputNum_close(){
	var obj1 = document.getElementById($IwmInput_ctrlId);
	var d1 = parseFloat(obj1.value);
	if(isNaN(d1)){
		d1 = 0;
	}
	obj1.value = d1;
	obj1 = null;
	subIwmInput_close("_InputNum");
}
function subIwmInputNum_keydown(
	$outputId // [id]
){
	document.onkeydown = function(evt){
		///console.log(evt.keyCode);
		switch(evt.keyCode){
			case(13): // [Enter]
				subIwmInputNum_close();
			break;
		}
	}
}
*/
function subIwmInputBL_open(
	$outputId // [id]
){
	var iId = "_InputBL";
	if($IwmInput_ctrlId == $outputId){
		subIwmInput_close(iId);
		$IwmInput_ctrlId = null;
		return;
	}
	$IwmInputBL_saveId = $outputId;

	// "_InputBL" を更新
	_iwmIBL($outputId);
	subIwmInput_open(iId, $outputId, null, null, false);
}
function subIwmInputBL_close(){
	document.getElementById($IwmInputBL_saveId).value = rtnGeoIBLto10A(
		document.getElementById("_IBL1").value,
		document.getElementById("_IBL2").value,
		document.getElementById("_IBL3").value
	);
	$IwmInput_ctrlId = null;
	subIwmInput_close("_InputBL");
}
function subIwmInputBL_saveId(
	$outputId // [id]
){
	$IwmInput_ctrlId = $outputId;
}
function subIwmInputBL_keydown(
	$outputId,   // [id]
	$decimalSize // 小数点桁数
){
	///console.log($decimalSize);
	if($decimalSize == undefined){
		$decimalSize = 0;
	}

	document.onkeydown = function(evt){
		///console.log(evt.keyCode);
		switch(evt.keyCode){
			case(13): // [Enter]
				var obj = document.getElementById($outputId);
					var d1 = parseFloat(obj.value).toFixed($decimalSize);
				obj.value = d1;
				obj = null;

				if($IwmInput_ctrlId == $IwmInputBL_saveId){
					_iwmIBL(d1);
				}
				else{
					document.getElementById($IwmInputBL_saveId).value = rtnGeoIBLto10A(
						document.getElementById("_IBL1").value,
						document.getElementById("_IBL2").value,
						document.getElementById("_IBL3").value
					);
				}
				// URL／BL表示を変更
				_iwmCU();
				// ベースマーカー再描画
				_iwmBMN();
				// センタリング
				_iwmCM();
				// 距離円再描画
				subGCircleInit();
			break;
		}
	}
}
function subIwmInput_open(
	$inputId,   // [id]
	$outputId,  // [id]
	$posX,      // iNT
	$posY,      // INT
	$autoHidden // BOOL
){
	$IwmInput_ctrlId = $outputId;

	// 他の入力フォームを全て閉じる
	subIwmInput_init();

	var obj = document.getElementById($outputId);
	var rect = obj.getBoundingClientRect();
		var posX = (
			($posX === undefined || $posX == null) ?
			(rect.left + window.pageXOffset) :
			$posX
		);
		var posY = (
			($posY === undefined || $posY == null) ?
			(rect.top + window.pageYOffset + obj.clientHeight) :
			$posY
		);
	obj = rect = null;

	with(document.getElementById($inputId).style){
		display = "";
		top  = posY + "px";
		left = posX + "px";
	}

	// 設定ミリ秒後に自動終了
	if($autoHidden){
		setTimeout("subIwmInput_close('" + $inputId + "')", 2500);
	}
}
function subIwmInput_close(
	$outputId // [id]
){
	try{
		document.getElementById($outputId).style.display = "none";
	}
	catch(e){
		///console.log(e);
	}
}
function subIwmInput_addText(
	$str
){
	var obj = document.getElementById($IwmInput_ctrlId);
		var strBefore = obj.value;
		var strBeforeLen = strBefore.length;
		var iSelection = obj.selectionStart;
		obj.value = strBefore.substr(0, iSelection) + $str + strBefore.substr(iSelection, strBeforeLen);
		iSelection++;
		obj.selectionStart = iSelection; // 再フォーカス
	obj = null;
}
function subIwmInput_cls(){
	document.getElementById($IwmInput_ctrlId).value = "";
}
function subIwmInput_bs(){
	var obj = document.getElementById($IwmInput_ctrlId);
		var strBefore = obj.value;
		var strBeforeLen = strBefore.length;
		var iSelection = obj.selectionStart;
		iSelection--;
		if(iSelection >= 0){
			obj.value = strBefore.substr(0, iSelection) + strBefore.substr((iSelection + 1), strBeforeLen);
			obj.selectionStart = iSelection; // 再フォーカス
		}
	obj = null;
}
function subIwmInput_del(){
	var obj = document.getElementById($IwmInput_ctrlId);
		var strBefore = obj.value;
		var strBeforeLen = strBefore.length;
		var iSelection = obj.selectionStart;
		if(iSelection < strBeforeLen){
			obj.value = strBefore.substr(0, iSelection) + strBefore.substr((iSelection + 1), strBeforeLen);
			obj.selectionStart = iSelection; // 再フォーカス
		}
	obj = null;
}
/*-------------
// エイリアス
-------------*/
// "_InputBL" を更新
function _iwmIBL(
	$d1 // DBL
){
	if(isNaN($d1)){
		$d1 = document.getElementById($d1).value;
	}
	var a1 = rtnGeo10toIBL($d1);
	var i1 = 0;
	var i2 = a1.length;

	document.getElementById("_IBL1").value = a1[0].toFixed(0);
	document.getElementById("_IBL2").value = a1[1].toFixed(0);
	document.getElementById("_IBL3").value = a1[2].toFixed(8);
}
// ベースマーカー再描画
function _iwmBMN(){
	subBaseMarkerNew(
		"_NaviLat",
		"_NaviLng"
	);
}
// URL／BL表示を変更
function _iwmCU(){
	subChangeUrl(
		"_NaviLat",
		"_NaviLng",
		"_NaviZoom"
	);
}
// センタリング
var $HashLatLng = null;

function _iwmCM(){
	if($HashLatLng){
		subCenterMap(
			$HashLatLng.lat,
			$HashLatLng.lng
		);
		$HashLatLng = null;
	}
	else{
		subCenterMap(
			"_NaviLat",
			"_NaviLng"
		);
	}
}
function _iwmZA(
	$str
){
	subIwmInputZoomA_close();
	subIwmInputZoom_change($str);

	// ベースマーカー再描画
	_iwmBMN();
	// URL／BL表示を変更
	_iwmCU();
	// センタリング
	_iwmCM();
	// 距離円再描画
	subGCircleInit();
}
function _iwmZA2(){
	subIwmInputZoomA_close();
	// センタリング
	_iwmCM();
	// 距離円再描画
	subGCircleInit();
}
function _iwmZB(
	$str
){
	subIwmInputZoom_change($str);

	// URL／BL表示を変更
	_iwmCU();
	// センタリング
	subCenterMap2();
	// 距離円再描画
	subGCircleInit();
}
const $AryIwmIBL = ["_IBL1", "_IBL2", "_IBL3"];
function _iwmBL(){
	var i1 = 0;
	var i2 = $AryIwmIBL.length;
	for(;i1 < i2 ; i1++){
		if($AryIwmIBL[i1] == $IwmInput_ctrlId){
			break;
		}
	}
	if(i1 == i2){
		// "_InputBL" を更新
		_iwmIBL($IwmInput_ctrlId);
	}
	subIwmInputBL_close();

	// URL／BL表示を変更
	_iwmCU();
	// ベースマーカー再描画
	_iwmBMN();
	// センタリング
	_iwmCM();
	// 距離円再描画
	subGCircleInit();
}
/*---------------------
// アドレスマッチング
---------------------*/
var $IntAddMatchCnt = 0;
var $AddMatchMarker = null;
const $HashAddMatchOutputZoom = {exist: "↑", none: "↓"};

// 初期化
function subAddMatchInit(){
	// 初期化
	$IntAddMatchCnt = 0;

	// Input
	with(document.getElementById("_AddMatchInput1")){
		value = "";
		focus();
	}
	// Zoom
	with(document.getElementById("_AddMatchInput2")){
		style.display = "none";
	}
	// Reset
	with(document.getElementById("_AddMatchInput3")){
		style.display = "none";
	}
	// Output
	with(document.getElementById("_AddMatchOutput")){
		style.display = "none";

		var obj = document.getElementById("_AddMatchInput1");
		var rect = obj.getBoundingClientRect();
			style.left = (rect.left + window.pageXOffset - 1) + "px";
			style.top  = (rect.top + window.pageYOffset + obj.clientHeight + 2) + "px";
		obj = rect = null;
		innerHTML = "";
	}
}
function subAddMatch1(){
	var query = document.getElementById("_AddMatchInput1").value;

	if(query.trim() == ""){
		subAddMatchInit();
		return;
	}
	var url = "https://msearch.gsi.go.jp/address-search/AddressSearch?q=" + query;

	var xhr = new XMLHttpRequest();
	xhr.onload = function(){
		var aJson = JSON.parse(xhr.responseText);
		$IntAddMatchCnt = aJson.length;

		// 再検索時に結果を表示させるため
		with(document.getElementById("_AddMatchInput2")){
			innerHTML = $HashAddMatchOutputZoom.none;
		}
		var flg = subAddMatch2();
		if(flg){
			with(document.getElementById("_AddMatchOutput")){
				var rtn = "<div id=\"_AddMatchOutputH\">◆ヒット数 " + $IntAddMatchCnt + " 件</div>";
				var i1 = 0;
				for(; i1 < $IntAddMatchCnt; i1++){
					with(aJson[i1]){
						var s1 = "";
						// データ不完全のため例外処理が必要
						try{
							var addCode = parseInt(properties.addressCode, 10) + "";
							var a1 = GSI.MUNI_ARRAY[addCode].split(",");
							s1 = a1[1] + " " + a1[3].replace("　", " ");
						}
						catch(e){
							///console.log(e + "\n" + i1 + " | " + properties.addressCode + " | " + properties.title + " | " + geometry.coordinates);
						}
						var a1 = geometry.coordinates;
						var aLatLng = [
							a1[1],
							a1[0]
						];

						rtn += "<div id=\"_AddMatchOutput1\" onmouseover=\"subAddMatchSpot([" + aLatLng + "],'" + properties.title + "');\" onmouseout=\"subAddMatchSpotClear();\" onclick=\"subMapOnRClick('" + aLatLng[0] + "','" + aLatLng[1] + "','" + properties.title + "');\">" +
							"<div class='_AddMatchRem'>" + s1 + "</div>" +
							properties.title + "</div>";
					}
				}
				// 著作権表示
				rtn += "<div id=\"_AddMatchOutputF\">【<a href='http://newspat.csis.u-tokyo.ac.jp/geocode/' target='_blank'>協力:東大CSIS</a>】</div>";
				innerHTML = rtn;
			}
		}
	}
	xhr.open("GET", url, true);
	xhr.overrideMimeType("text/javascript");
	xhr.send(null);
}
function subAddMatch2(){
	var rtn = true;

	_input2 = document.getElementById("_AddMatchInput2");
	_input3 = document.getElementById("_AddMatchInput3");
	_output = document.getElementById("_AddMatchOutput");

	if($IntAddMatchCnt > 1000){
		_input2.style.display = "none";
		_input3.style.display = "";
		with(_output){
			style.display = "";
			style.height = "auto";
			innerHTML = "★ヒット数が1000件超あります!!<br>　条件を増やしてみてください。";
		}
		rtn = false;
	}
	else if($IntAddMatchCnt > 0){
		_input2.style.display = "";
		_input3.style.display = "";
		with(_output){
			style.display = "";
		}
		if(_input2.innerHTML == $HashAddMatchOutputZoom.exist){
			_input2.innerHTML = $HashAddMatchOutputZoom.none;
			_output.style.display = "none";
		}
		else{
			_input2.innerHTML = $HashAddMatchOutputZoom.exist;
			with(_output){
				style.display = "";
			}
			rtn = true;
		}
	}
	else{
		_input2.style.display = "none";
		_input3.style.display = "";
		with(_output){
			style.display = "";
			style.height = "auto";
			innerHTML = "★ヒット数が0件です。<br>　条件を変えてみてください。";
		}
		rtn = false;
	}
	_input2 = null;
	_input3 = null;
	_output = null;

	return rtn;
}
function subAddMatchSpot(
	$aLatLng,
	$title
){
	$AddMatchMarker = (
		L.circleMarker(
			[
				$aLatLng[0],
				$aLatLng[1]
			],
			{
				radius: 8,
				color: "#ff5",
				weight: 8,
				fill: true,
				fillColor: "#f00",
				fillOpacity: 0.8,
				title: $title
			}
		).addTo($Map).bindPopup(
			$title,
			{
				autoPan: false,
				closeButton: false
			}
		).openPopup()
	);
}
function subAddMatchSpotClear(){
	if($AddMatchMarker){
		$Map.removeLayer($AddMatchMarker);
		$AddMatchMarker = null;
	}
}
/*-------------------------------
// 緯度経度⇒アドレスマッチング
-------------------------------*/
function subLngLatToPlaceName(
	$lat,
	$lng,
	$oMarker,
	$placeName
){
	var url = "https://mreversegeocoder.gsi.go.jp/reverse-geocoder/LonLatToAddress" +
		"?lat=" + $lat +
		"&lon=" + $lng;

	var xhr = new XMLHttpRequest();
	xhr.onload = function(){
		var title = null;
		obj = JSON.parse(xhr.responseText);
		if(obj.results === undefined){
			title = "---";
		}
		else{
			var muniCd = parseInt(obj.results.muniCd, 10);
			var lv01Nm = obj.results.lv01Nm;
			var a1 = GSI.MUNI_ARRAY[muniCd].split(",");
			title = (a1[1] + a1[3] + lv01Nm).replace(/　/g, "");
		}
		// 地名付与 ⇒ 自由／固定区別
		if($oMarker.options.draggable){
			$oMarker.options.title = title;
		}
		else{
			// 固定点地名 ⇒ 初回に付与してあればパス
			if(!$oMarker.options.title){
				$oMarker.options.title = $placeName + "<br>＠" + title;
			}
		}
		obj = null;
	};
	xhr.open("GET", url, true);
	xhr.overrideMimeType("text/javascript");
	xhr.send(null);
}
/*-------------
// 距離円作成
-------------*/
var $GCircle = null;

// 初期化
function subGCircleInit(){
	var map = $Map;
	var marker = $BaseMarker;

	if($GCircle){
		$GCircle.remove();
	}

	$GCircle = L.greatCircle(marker.getLatLng(), {
		radius: subGCircleCnv(),
		color: "#00f",
		fill: true,
		fillColor: "#00f",
		fillOpacity: 0.1
	});

	$GCircle.addTo(map);
	$GCircle.bindTo(marker);
}
// スライダー制御
function subGCircleSlider(){
	var iDist = subGCircleCnv();
	document.getElementById("$GCircleKm").innerHTML = (iDist / 1000.0).toFixed(2) + "km"
	$GCircle.setRadius(iDist);
}
// 目盛毎の単位で変換 (例)10 => 10mスケール
function subGCircleCnv(){
	const scale = 10; // Meter単位
	return parseInt(document.getElementById("$GCircleRad").value, 10) * scale;
}
/*----------------
// Simple Window
----------------*/
// 初期化
function subSimpleWindowInit(
	$aryId
){
	var i1 = $aryId.length;
	while(i1--){
		document.getElementById($aryId[i1]).style.display = "none";
	}
}
function subSimpleWindowOnOff(
	$id,
	$func
){
	// Open／Close
	var obj = document.getElementById($id);
	if(obj.style.display == ""){
		obj.style.display = "none";
	}
	else{
		obj.style.display = "";
		eval($func);
	}
}
function subSW01(
	$id
){
	document.getElementById("_SW01A").innerHTML = document.getElementById("_HDoc01").value;
}
/*---------------
// Edit Textbox
---------------*/
/*---------------
// 地図から読込
---------------*/
function subMapToPoint(
	$textareaId
){
	// 上書き
	document.getElementById($textareaId).value = "";

	var s1 = "";

	var aSM = $AryPoint;
	var i1 = 0;
	var i2 = aSM.length;
	for(; i1 < i2; i1++){
		s1 += aSM[i1]._latlng.lat.toFixed(8) + "\t";
		s1 += aSM[i1]._latlng.lng.toFixed(8) + "\t";
		s1 += aSM[i1].options.title + "\n";
	}

	var aLM = $AryLocalMarker;
	var i1 = 0;
	var i2 = aLM.length;
	for(; i1 < i2; i1++){
		s1 += aLM[i1]._latlng.lat.toFixed(8) + "\t";
		s1 += aLM[i1]._latlng.lng.toFixed(8) + "\t";
		s1 += aLM[i1].options.title + "\n";
	}
	document.getElementById($textareaId).value += s1;
	s1 = null;
}
/*----------------------
// ファイル読込（追加）
----------------------*/
var $FileName = "";

function subAddReadFile(
	$fileId,
	$textareaId
){
	// ボタンにイベントを設定
	var fileList = document.getElementById($fileId).files;

	// ファイル名記憶
	$FileName = fileList[0].name;

	var reader = new FileReader();
	reader.onload = function(evt){
		// 追加保存
		document.getElementById($textareaId).value += evt.target.result;
	}
	// テキスト書込
	reader.readAsText(fileList[0]);
	fileList = null;
}
/*---------------
// 住所から変換
---------------*/
function subM2P_Geocoding(
	$textareaId
){
	var $Url = "https://msearch.gsi.go.jp/address-search/AddressSearch?q=";
	var xhr = new XMLHttpRequest();

	var a1 = document.getElementById($textareaId).value.replace(/\\t/g, "\t").split("\n");

	var $ErrCnt = 0;

	var s1 = "";
	var i1 = 0;
	var i2 = a1.length;

	for(; i1 < i2; i1++){
		var a2 = a1[i1].trim().split("\t");
		var Query = a2[0];

		if(Query){
			if(Query[0].match(/#|[0-9]/)){
				s1 += a1[i1] + "\n";
			}
			else{
				var url = $Url + Query;

				xhr.open("GET", url, false);
				xhr.overrideMimeType("text/javascript");
				xhr.send(null);

				var aJson = JSON.parse(xhr.responseText);

				if(aJson.length == 1){
					var a3 = aJson[0].geometry.coordinates;
					var tmp = a3[0]; a3[0] = a3[1]; a3[1] = tmp;

					a3[0] = a3[0].toFixed(8);
					a3[1] = a3[1].toFixed(8);

					s1 += a3.join("\t") + "\t" + a1[i1];
				}
				else{
					$ErrCnt++;
					s1 += "# Err " + (aJson.length == 0 ? "該当なし" : "複数該当あり") + " => " + a1[i1];
				}
				s1 += "\n";
			}
		}
	}

	if(s1){
		document.getElementById($textareaId).value = s1;
	}

	with(document.getElementById($textareaId).style){
		if($ErrCnt){
			color = "#ffffff";
			backgroundColor = "#ff0000";
		}
		else{
			color = "#000000";
			backgroundColor = "#ffffff";
		}
	}
	xhr = s1 = a1 = null;
}
/*---------------
// サンプル出力
---------------*/
function subM2P_GeocodingSample(
	$textareaId
){
	document.getElementById($textareaId).value = "千代田区千代田1-1\t皇居\nつくば市北郷１\t国土地理院\n";
}
/*-------------------------
// クリップボードにコピー
-------------------------*/
function subM2P_EditCopy(
	$id
){
	document.getElementById($id).select();
	document.execCommand("copy");
}
/*-------------
// 地図へ反映
-------------*/
var $AryPoint = [];

function subM2P_PointToMap(
	$textareaId
){
	var i1 = $AryPoint.length;
	while(i1--){
		// マーカー削除
		$Map.removeLayer($AryPoint[i1]);
		// 配列から削除
		$AryPoint.splice(i1, 1);
	}
	var $latOld = null;
	var $lngOld = null;

	var rtn ="";

	var a1 = document.getElementById($textareaId).value.replace(/\\t/g, "\t").split("\n");

	var i1 = 0;
	var i2 = a1.length;
	for(; i1 < i2; i1++){
		try{
			var a2 = a1[i1].trim().split("\t");

			if($latOld == null){
				$latOld = a2[0];
				$lngOld = a2[1];
			}
			else{
				$latOld = a2[0];
				$lngOld = a2[1];
			}

			var s2 = a2[2];
			var i3 = 3;
			var i4 = a2.length;
			for(; i3 < i4; i3++){
				s2 += "<br>" + a2[i3];
			}

			var obj1 = (
				L.circleMarker(
					[
						a2[0],
						a2[1]
					],
					{
						radius: 8,
						color: "#5ff",
						weight: 8,
						fill: true,
						fillColor: "#00f",
						fillOpacity: 0.8,
						title: s2
					}
				).addTo($Map)
			);

			var obj2 = null;
			if(a2[2].trim()){
				obj2 = obj1.bindPopup(
					s2,
					{
						autoPan: false,
						closeButton: true
					}
				).openPopup();
			}
			else{
				obj2 = obj1;
			}
			$AryPoint.push(obj2);

			rtn += a1[i1] + "\n";
		}
		catch(e){
			///console.log(a1[i1]);
		}
	}

	if(rtn){
		document.getElementById($textareaId).value = rtn;
	}

	rtn= s1 = s2 = a1 = a2 = obj1 = obj2 = null;
}
/*---------------
// ファイル保存
---------------*/
function subM2P_EditSave(
	$textareaId,
	$hrefId
){
	var content = document.getElementById($textareaId).value;
	var blob = new Blob([content], {"type" : "text/plain"});
	var fn = ($FileName ? $FileName : "マーカー変換.tsv");
	// ファイル名：yyyymmdd_hhnnss.tsv
	/*
		var curDate = new Date();
		var fn = "" + curDate.getFullYear();
			fn += ("0" + (curDate.getMonth() + 1)).substr(-2);
			fn += ("0" + curDate.getDate()).substr(-2);
			fn += "_";
			fn += ("0" + curDate.getHours()).substr(-2);
			fn += ("0" + curDate.getMinutes()).substr(-2);
			fn += ("0" + curDate.getSeconds()).substr(-2);
			fn += ".tsv";
	*/
	// MSIE?
	if(window.navigator.msSaveBlob){ 
		window.navigator.msSaveBlob(blob, fn);
		window.navigator.msSaveOrOpenBlob(blob, fn); 
	}
	else{
		document.getElementById($hrefId).download = fn;
		document.getElementById($hrefId).href = window.URL.createObjectURL(blob);
	}
	content = blob = fn = null;
}
/*---------
// クリア
---------*/
function subM2P_EditClear(
	$textareaId,
	$selectId
){
	document.getElementById($textareaId).value = "";
	document.getElementById($selectId).value = 0;

	subM2P_GCircle($selectId, $textareaId);

	var i1 = $AryPoint.length;
	while(i1--){
		// マーカー削除
		$Map.removeLayer($AryPoint[i1]);
		// 配列から削除
		$AryPoint.splice(i1, 1);
	}
}
/*--------------------
// URL／BL表示を変更
--------------------*/
function subChangeUrl(
	$Lat,
	$Lng,
	$Zoom
){
	var i1 = 0;
	var i2 = arguments.length;
	for(; i1 < i2; i1++){
		if(isNaN(arguments[i1])){
			arguments[i1] = document.getElementById(arguments[i1]).value;
		}
	}
	with(document){
		getElementById("_NaviLat").value  = parseFloat($Lat).toFixed(8);
		getElementById("_NaviLng").value  = parseFloat($Lng).toFixed(8);
		getElementById("_NaviZoom").value = $Zoom;
	}
	// URL置換
	history.replaceState(
		null,
		null,
		("#" + $Zoom + "/" + $Lat + "/" + $Lng)
	);
}
/*------------------------------------
// (例) (255, 255, 255) => "#ffffff"
------------------------------------*/
/*
function rtnRgbTo16(
	$r,
	$g,
	$b
){
	var rtn = "#";
	for(var _i1 = 0; _i1 < 3; _i1++){
		var _i2 = parseInt(arguments[_i1], 10);
		if(_i2 < 0){
			_i2 = 0;
		}
		else if(_i2 > 255){
			_i2 = 255;
		}
		rtn += ("0" + _i2.toString(16)).slice(-2);
	}
	return rtn;
}
*/
/*---------------
// 範囲円を描画
---------------*/
$AryM2P_Circle = [];

function subM2P_GCircle(
	$selectId,
	$textareaId
){
	// 消去
	var i1 = 0;
	var i2 = $AryM2P_Circle.length;
	for(; i1 < i2; i1++){
		$AryM2P_Circle[i1].remove();
	}

	// 描画
	var rad = parseInt(document.getElementById($selectId).value, 10);
	if(rad < 1){
		return;
	}

	var a1 = document.getElementById($textareaId).value.trim().split("\n");

	var i1 = 0;
	var i2 = a1.length;
	for(; i1 < i2; i1++){
		var a2 = a1[i1].split(/[\t:]/);
		$AryM2P_Circle[i1] = L.greatCircle([a2[0], a2[1]], {
			radius: parseInt(document.getElementById($selectId).value, 10),
			color: "#f00",
			fill: true,
			fillColor: "#f00",
			fillOpacity: 0.1
		});
		$AryM2P_Circle[i1].addTo($Map);
	}
}
/*-------------------
// 度分秒 => 十進法
-------------------*/
function rtnGeoIBLto10A(
	$deg, // 度
	$min, // 分
	$sec  // 秒
){
	$deg = parseInt($deg, 10);
	$min = parseInt($min, 10);
	$sec = parseFloat($sec);
	return parseFloat($deg + ($min / 60.0) + ($sec / 3600.0));
}
/*-------------------
// 十進法 => 度分秒
-------------------*/
function rtnGeo10toIBL(
	$angle // 十進法
){
	$angle = parseFloat($angle);

	var deg = parseInt($angle, 10);
		$angle = ($angle - deg) * 60.0;
	var min = parseInt($angle, 10);
		$angle -= min;
	var sec = parseFloat($angle) * 60.0;

	// 0.999... * 60 => 60.0 対策
	if(sec == 60.0){
		min += 1;
		sec = 0;
	}
	return [parseInt(deg, 10), parseInt(min, 10), parseFloat(sec)];
}
/*-------------------------------
// Vincenty法による２点間の距離
-------------------------------*/
/*【参考】
	http://tancro.e-central.tv/grandmaster/script/vincentyJS.html
*/
function rtnGeoVincentry(
	$lat1,
	$lng1,
	$lat2,
	$lng2
){
	$lat1 = parseFloat($lat1);
	$lng1 = parseFloat($lng1);
	$lat2 = parseFloat($lat2);
	$lng2 = parseFloat($lng2);

	if ($lat1 == $lat2 && $lng1 == $lng2){
		return [0, 0];
	}

	///const _A = 6378137.0;
	const _B   = 6356752.314;
	const _F   = 1 / 298.257222101;
	const _RAD = Math.PI / 180.0

	var latR1 = $lat1 * _RAD;
	var lngR1 = $lng1 * _RAD;
	var latR2 = $lat2 * _RAD;
	var lngR2 = $lng2 * _RAD;

	var f1 = 1 - _F;

	var omega = lngR2 - lngR1;
	var tanU1 = f1 * Math.tan(latR1);
	var cosU1 = 1 / Math.sqrt(1 + tanU1 * tanU1);
	var sinU1 = tanU1 * cosU1;
	var tanU2 = f1 * Math.tan(latR2);
	var cosU2 = 1 / Math.sqrt(1 + tanU2 * tanU2);
	var sinU2 = tanU2 * cosU2;
	var lamda = omega;
	var dLamda;
	var count = 0;

	var sinLamda  = 0.0;
	var cosLamda  = 0.0;
	var sin2sigma = 0.0;
	var sinSigma  = 0.0;
	var cosSigma  = 0.0;
	var sigma     = 0.0;
	var sinAlpha  = 0.0;
	var cos2alpha = 0.0;
	var cos2sm    = 0.0;
	var c = 0.0;

	do{
		sinLamda = Math.sin(lamda);
		cosLamda = Math.cos(lamda);
		sin2sigma = (cosU2 * sinLamda) * (cosU2 * sinLamda) + (cosU1 * sinU2 - sinU1 * cosU2 * cosLamda) * (cosU1 * sinU2 - sinU1 * cosU2 * cosLamda);
		if(sin2sigma < 0){
			return [0, 0];
		}
		sinSigma = Math.sqrt(sin2sigma);
		cosSigma = sinU1 * sinU2 + cosU1 * cosU2 * cosLamda;
		sigma = Math.atan2(sinSigma, cosSigma);
		sinAlpha = cosU1 * cosU2 * sinLamda / sinSigma;
		cos2alpha = 1 - sinAlpha * sinAlpha;
		cos2sm = cosSigma - 2 * sinU1 * sinU2 / cos2alpha;
		if(isNaN(cos2sm)){
			cos2sm = 0;
		}
		c = _F / 16 * cos2alpha * (4 + _F * (4 - 3 * cos2alpha));
		dLamda = lamda;
		lamda = omega + (1 - c) * _F * sinAlpha * (sigma + c * sinSigma * (cos2sm + c * cosSigma * (-1 + 2 * cos2sm * cos2sm)));
		if(count++ > 10){
			break;
		}
	}while(Math.abs(lamda - dLamda) > 1e-12);

	var u2 = cos2alpha * (1 - f1 * f1) / (f1 * f1);
	var a = 1 + u2 / 16384 * (4096 + u2 * (-768 + u2 * (320 - 175 * u2)));
	var b = u2 / 1024 * (256 + u2 * (-128 + u2 * (74 - 47 * u2)));
	var dSigma = b * sinSigma * (cos2sm + b / 4 * (cosSigma * (-1 + 2 * cos2sm * cos2sm) - b / 6 * cos2sm * (-3 + 4 * sinSigma * sinSigma) * (-3 + 4 * cos2sm * cos2sm)));
	var alpha12 = Math.atan2(cosU2 * sinLamda, cosU1 * sinU2 - sinU1 * cosU2 * cosLamda) * 180 / Math.PI;
	var dist = _B * a * (sigma - dSigma);

	// 変換
	if(alpha12 < 0){
		alpha12 += 360.0; // "度"
	}
	dist /= 1000.0; // "m" => "km"

	return [parseFloat(dist), parseFloat(alpha12)];
}
/*-----------
// 標高取得
-----------*/
function subGetElevation(
	$lat,
	$lng,
	$oMarker
){
	var url = "https://cyberjapandata2.gsi.go.jp/general/dem/scripts/getelevation.php?" +
		"lat=" + $lat +
		"&lon=" + $lng +
		"&outtype=JSON";

	var xhr = new XMLHttpRequest();
	xhr.onload = function(){
		try{
			var json = xhr.response;
			$oMarker.elevation = json.elevation + "m DEM" + json.hsrc;
		}
		catch(e){
			$oMarker.elevation = "---";
		}
	};
	xhr.open("GET", url, true);
	xhr.responseType = "json";
	xhr.send(null);
}
/*---------------------------------
// ポップアップ ← ベースマーカー
---------------------------------*/
function subMarkerPopup1(
	$lat,
	$lng
){
	subLngLatToPlaceName(
		$lat,
		$lng,
		$BaseMarker,
		null
	);
	a1 = rtnGeo10toIBL($lat);
	var latRem = a1[0] + "度" + a1[1] + "分" + parseFloat(a1[2]).toFixed(6) + "秒";

	a1 = rtnGeo10toIBL($lng);
	var lngRem = a1[0] + "度" + a1[1] + "分" + parseFloat(a1[2]).toFixed(6) + "秒";

	a1 = null;

	var elevation = "---";

	if($IsMSIE == 0){
		subGetElevation($lat, $lng, $BaseMarker);
		elevation = $BaseMarker.elevation;
	}

	return (
		"<font color='#ff5858'>" + $BaseMarker.options.title + "</font><br>" +
		"<font color='#3d7cce'>北緯</font>" + latRem + "／" + $lat.toFixed(6) + "度<br>" +
		"<font color='#3d7cce'>東経</font>" + lngRem + "／" + $lng.toFixed(6) + "度<br>" +
		"<font color='#3d7cce'>標高</font>" + elevation
	);
}
/*-----------------------------------
// ポップアップ ← ローカルマーカー
-----------------------------------*/
function subMarkerPopup2(
	$latFrom,
	$lngFrom,
	$latTo,
	$lngTo,
	$oMarker
){
	subLngLatToPlaceName(
		$latTo,
		$lngTo,
		$oMarker,
		null
	);
	a1 = rtnGeo10toIBL($latTo);
	var latRem = a1[0] + "度" + a1[1] + "分" + parseFloat(a1[2]).toFixed(6) + "秒";

	a1 = rtnGeo10toIBL($lngTo);
	var lngRem = a1[0] + "度" + a1[1] + "分" + parseFloat(a1[2]).toFixed(6) + "秒";

	a1 = null;

	var elevation = "---";

	var ad1 = rtnGeoVincentry($latFrom, $lngFrom, $latTo, $lngTo);

	var distRem = ad1[0].toFixed(4) + "km";

	var angleRem = "";
	var d2 = ad1[1].toFixed(4);
	if(d2 >= 337.5 || d2 <= 22.5){
		angleRem = "北";
	}
	else if(d2 > 22.5 && d2 < 67.5){
		angleRem = "北東";
	}
	else if(d2 >= 67.5 && d2 <= 112.5){
		angleRem = "東";
	}
	else if(d2 > 112.5 && d2 < 157.5){
		angleRem = "南東";
	}
	else if(d2 >= 157.5 && d2 <= 202.5){
		angleRem = "南";
	}
	else if(d2 > 202.5 && d2 < 247.5){
		angleRem = "南西";
	}
	else if(d2 >= 247.5 && d2 <= 292.5){
		angleRem = "西";
	}
	else if(d2 > 292.5 && d2 < 337.5){
		angleRem = "北西";
	}
	angleRem += d2 + "度";

	var elevation = "---";

	if($IsMSIE == 0){
		subGetElevation($latTo, $lngTo, $oMarker);
		elevation = $oMarker.elevation;
	}
	return (
		"<font color='#ff5858'>" + $oMarker.options.title + "</font><br>" +
		"<font color='#3d7cce'>北緯</font>" + latRem + "／" + $latTo.toFixed(6) + "度<br>" + 
		"<font color='#3d7cce'>東経</font>" + lngRem + "／" + $lngTo.toFixed(6) + "度<br>" + 
		"<font color='#3d7cce'>標高</font>" + elevation + "<br>" +
		"<font color='#3d7cce'>距離</font>" + distRem + "／" + angleRem
	);
}
/*------------------------------------
// [マーカー削除]ボタン 表示／非表示
------------------------------------*/
function subMyObj_init(){
	document.getElementById("_btnMarker").style.display = "none";
}
function subMyObj_onOff(
	$aryObj
){
	document.getElementById("_btnMarker").style.display = ($aryObj.length > 0 ? "" : "none");
}
/*-----------------------
// ローカルマーカー削除
-----------------------*/
function subMyObj_remove(
	$aryObj
){
	while((obj = $aryObj.pop()) != undefined){
		$Map.removeLayer(obj);
	}
	// [マーカー削除]ボタン 非表示
	document.getElementById("_btnMarker").style.display = "none";
}
/*----------------------
// [Tab]入力可能にする
----------------------*/
/*【参考】
	http://www.webclap-dandy.com/?category=Programing&id=5
*/
function subAddTabCtrl(
	$e,
	$obj
){
	if($e.keyCode != 9){
		return;
	}
	$e.preventDefault();

	var cursorPosition = $obj.selectionStart;
	var cursorLeft  = $obj.value.substr(0, cursorPosition);
	var cursorRight = $obj.value.substr(cursorPosition, $obj.value.length);

	$obj.value = cursorLeft + "\t" + cursorRight;
	$obj.selectionEnd = cursorPosition + 1;
}
</script>

</head>

<body onload="subInitDisp();subIwmInput_init();subMyObj_init();subAddMatchInit();subGCircleInit();subSimpleWindowInit(['_SW03','_SW02','_SW01']);" onresize="subInitDisp();">
	<!---------------
	// 数値入力補完
	---------------->
	<div id="_InputZoomA">
		ズームレベル<br>
		<input type="button" class="_ZA" value="5" onclick="_iwmZA('5');"><input type="button" class="_ZA" value="6" onclick="_iwmZA('6');"><input type="button" class="_ZA" value="7" onclick="_iwmZA('7');"><input type="button" class="_ZA" value="8" onclick="_iwmZA('8');"><input type="button" class="_ZA" value="9" onclick="_iwmZA('9');"><br>
		<input type="button" class="_ZA" value="10" onclick="_iwmZA('10');"><input type="button" class="_ZA" value="11" onclick="_iwmZA('11');"><input type="button" class="_ZA" value="12" onclick="_iwmZA('12');"><input type="button" class="_ZA" value="13" onclick="_iwmZA('13');"><input type="button" class="_ZA" value="14" onclick="_iwmZA('14');"><br>
		<input type="button" class="_ZA" value="15" onclick="_iwmZA('15');"><input type="button" class="_ZA" value="16" onclick="_iwmZA('16');"><input type="button" class="_ZA" value="17" onclick="_iwmZA('17');"><input type="button" class="_ZA" value="18" onclick="_iwmZA('18');"><input type="button" class="_ZA" value="19" onclick="_iwmZA('19');"><br>
		<input type="button" class="_ZA" value="20" onclick="_iwmZA('20');"><input type="button" class="_ZA" value="21" onclick="_iwmZA('21');"><input type="button" class="_ZA" value="22" onclick="_iwmZA('22');"><input type="button" class="_ZA" value="23" onclick="_iwmZA('23');"><input type="button" class="_Btn3" value="＋" onclick="_iwmZA2();">
	</div>
	<div id="_InputZoomB">
		<input type="button" class="_ZB" value="23" onclick="_iwmZB('23');"><br>
		<input type="button" class="_ZB" value="22" onclick="_iwmZB('22');"><br>
		<input type="button" class="_ZB" value="21" onclick="_iwmZB('21');"><br>
		<input type="button" class="_ZB" value="20" onclick="_iwmZB('20');"><br>
		<input type="button" class="_ZB" value="19" onclick="_iwmZB('19');"><br>
		<input type="button" class="_ZB" value="18" onclick="_iwmZB('18');"><br>
		<input type="button" class="_ZB" value="17" onclick="_iwmZB('17');"><br>
		<input type="button" class="_ZB" value="16" onclick="_iwmZB('16');"><br>
		<input type="button" class="_ZB" value="15" onclick="_iwmZB('15');"><br>
		<input type="button" class="_ZB" value="14" onclick="_iwmZB('14');"><br>
		<input type="button" class="_ZB" value="13" onclick="_iwmZB('13');"><br>
		<input type="button" class="_ZB" value="12" onclick="_iwmZB('12');"><br>
		<input type="button" class="_ZB" value="11" onclick="_iwmZB('11');"><br>
		<input type="button" class="_ZB" value="10" onclick="_iwmZB('10');"><br>
		<input type="button" class="_ZB" value="9" onclick="_iwmZB('9');"><br>
		<input type="button" class="_ZB" value="8" onclick="_iwmZB('8');"><br>
		<input type="button" class="_ZB" value="7" onclick="_iwmZB('7');"><br>
		<input type="button" class="_ZB" value="6" onclick="_iwmZB('6');"><br>
		<input type="button" class="_ZB" value="5" onclick="_iwmZB('5');">
	</div>
	<!--
	<div id="_InputNum">
		<input type="button" class="_Btn1" value="7" onclick="subIwmInput_addText('7');"><input type="button" class="_Btn1" value="8" onclick="subIwmInput_addText('8');"><input type="button" class="_Btn1" value="9" onclick="subIwmInput_addText('9');"><br>
		<input type="button" class="_Btn1" value="4" onclick="subIwmInput_addText('4');"><input type="button" class="_Btn1" value="5" onclick="subIwmInput_addText('5');"><input type="button" class="_Btn1" value="6" onclick="subIwmInput_addText('6');"><br>
		<input type="button" class="_Btn1" value="1" onclick="subIwmInput_addText('1');"><input type="button" class="_Btn1" value="2" onclick="subIwmInput_addText('2');"><input type="button" class="_Btn1" value="3" onclick="subIwmInput_addText('3');"><br>
		<input type="button" class="_Btn1" value="0" onclick="subIwmInput_addText('0');"><input type="button" class="_Btn1" value="." onclick="subIwmInput_addText('.');"><input type="button" class="_Btn2" value="Cls" onclick="subIwmInput_cls();"><br>
		<input type="button" class="_Btn2" value="BS" onclick="subIwmInput_bs();"><input type="button" class="_Btn2" value="Del" onclick="subIwmInput_del();"><input type="button" class="_Btn3" value="OK" onclick="subIwmInputNum_close();">
	</div>
	-->
	<div id="_InputBL">
		<input type="text" id="_IBL1" onclick="subIwmInputBL_saveId(this.id);" onkeydown="subIwmInputBL_keydown(this.id, 0);" style="width:37px;">度<input type="text" id="_IBL2" onclick="subIwmInputBL_saveId(this.id);" onkeydown="subIwmInputBL_keydown(this.id, 0);" style="width:37px;">分<br>
		<input type="text" id="_IBL3" onclick="subIwmInputBL_saveId(this.id);" onkeydown="subIwmInputBL_keydown(this.id, 8);" style="width:96px;">秒<br>
		<input type="button" class="_Btn1" value="7" onclick="subIwmInput_addText('7');"><input type="button" class="_Btn1" value="8" onclick="subIwmInput_addText('8');"><input type="button" class="_Btn1" value="9" onclick="subIwmInput_addText('9');"><br>
		<input type="button" class="_Btn1" value="4" onclick="subIwmInput_addText('4');"><input type="button" class="_Btn1" value="5" onclick="subIwmInput_addText('5');"><input type="button" class="_Btn1" value="6" onclick="subIwmInput_addText('6');"><br>
		<input type="button" class="_Btn1" value="1" onclick="subIwmInput_addText('1');"><input type="button" class="_Btn1" value="2" onclick="subIwmInput_addText('2');"><input type="button" class="_Btn1" value="3" onclick="subIwmInput_addText('3');"><br>
		<input type="button" class="_Btn1" value="0" onclick="subIwmInput_addText('0');"><input type="button" class="_Btn1" value="." onclick="subIwmInput_addText('.');"><input type="button" class="_Btn2" value="Cls" onclick="subIwmInput_cls();"><br>
		<input type="button" class="_Btn2" value="BS" onclick="subIwmInput_bs();"><input type="button" class="_Btn2" value="Del" onclick="subIwmInput_del();"><input type="button" class="_Btn3" value="OK" onclick="_iwmBL();">
	</div>
	<!---------------------
	// アドレスマッチング
	---------------------->
	<div id="_AddMatchInput">
		<input type="text" id="_AddMatchInput1" onchange="subAddMatch1();" placeholder="住所検索"><font id="_AddMatchInput2" onclick="subAddMatch2();"></font><font id="_AddMatchInput3" onclick="subAddMatchInit();">×</font>
	</div>
	<div id="_AddMatchOutput"></div>
	<!-------------
	// 距離円描画
	-------------->
	<div id="_GCircle">距離円<input type="range" min="0" max="2000" value="0" class="slider" id="$GCircleRad" oninput="subGCircleSlider();"><span id="$GCircleKm">0km</span></div>
	<!-------------------
	// 地理院地図の設定
	-------------------->
	<div id="_divNaviCommander">
		北緯：<input type="text" id="_NaviLat" onclick="subIwmInputBL_open(this.id);" onkeydown="subIwmInputBL_keydown(this.id, 8);" placeholder="緯度入力"/>
		東経：<input type="text" id="_NaviLng" onclick="subIwmInputBL_open(this.id);" onkeydown="subIwmInputBL_keydown(this.id, 8);" placeholder="経度入力"/>
		<!-- ズーム --><input type="hidden" id="_NaviZoom"/>
		<input type="button" class="_btnNavi1" value="＋" onclick="_iwmZA2();"/>
		<input type="button" id="_btnMarker" class="_btnNavi2" value="マーカー削除" onclick="subMyObj_remove($AryLocalMarker);"/>
		<!---------
		// ヘルプ
		---------->
		<span style="float:right;margin:0 8px;">
			<font class="_simpleWindowCall" onclick="subSimpleWindowOnOff('_SW01','subSW01(\'_SW01A\')');" style="font-weight:900;">？</font>
		</span>
		<div id="_SW01" class="_simpleWindow" style="width:320px;">
			<font class="_simpleWindowTitle">操作説明</font>
			<font class="_simpleWindowClose" onclick="subSimpleWindowOnOff('_SW01');">×</font>
			<div id="_SW01A" class="_simpleWindowOutput" style="max-height:480px;"></div>
		</div>
		<!-----------------
		// 追加タイル編集
		------------------>
		<span style="float:right;margin:0 8px;">
			<font class="_simpleWindowCall" onclick="subSimpleWindowOnOff('_SW02');" style="font-weight:500;">追加タイル編集</font>
		</span>
		<div id="_SW02" class="_simpleWindow" style="width:400px;">
			<font class="_simpleWindowTitle">追加タイル編集／[Tab]区切り</font>
			<font class="_simpleWindowClose" onclick="subSimpleWindowOnOff('_SW02');">×</font>
			<br>
			<textarea id="_TA01" class="_editTextBox" wrap="off" style="height:180px;width:380px;" onchange="subMapSelector();"></textarea>
			<script>
				document.getElementById("_TA01").onkeydown = function(e){subAddTabCtrl(e, this);}
			</script>
			<div style="margin:10px 0;">
				<a class="_btnNavi1" href="http://maps.gsi.go.jp/development/ichiran.html" target="_blank" style="font-size:14px;">地理院タイル一覧⇒</a>
			</div>
		</div>
		<!---------------
		// マーカー変換
		---------------->
		<span style="float:right;margin:0 8px;">
			<font class="_simpleWindowCall" onclick="subSimpleWindowOnOff('_SW03');">マーカー変換</font>
		</span>
		<div id="_SW03" class="_simpleWindow" style="width:460px;">
			<font class="_simpleWindowTitle">マーカーをポイントに変換／[Tab]区切り／UTF-8N）</font>
			<font class="_simpleWindowClose" onclick="subSimpleWindowOnOff('_SW03');">×</font>
			<div class="_simpleWindowOutput" style="background:#fafafa;min-height:300px;padding:8px 12px;">
				<input type="button" class="_btnNavi3" value=">>地図から読込" onclick="subMapToPoint('_TA02');"/>
				<input type="file" id="_readFn" class="_btnNavi2" onchange="subAddReadFile(this.id,'_TA02');"/>
				<br>
				<textarea id="_TA02" class="_editTextBox" wrap="off" style="height:240px;width:418px;"></textarea>
				<script>
					document.getElementById("_TA02").onkeydown = function(e){subAddTabCtrl(e, this);}
				</script>
				<br>
				<input type="button" class="_btnNavi4" style="margin:3px 0 0 0;" value=">>住所から変換" onclick="subM2P_Geocoding('_TA02');">
				<input type="button" class="_btnNavi4" style="margin:3px 0 0 0;" value="↑サンプル出力" onclick="subM2P_GeocodingSample('_TA02');">
				<input type="button" class="_btnNavi1" value="クリップボードにコピー" onclick="subM2P_EditCopy('_TA02');"/>
				<br>
				<input type="button" class="_btnNavi3" value="<<地図へ反映" onclick="subM2P_PointToMap('_TA02');"/>
				<a id="_btnDL" class="_btnNavi2" href="#" download="" onclick="subM2P_EditSave('_TA02',this.id)">ファイルに保存</a>
				<input type="button" class="_btnNavi1" value="クリア" style="margin:3px 0 0 0;" onclick="subM2P_EditClear('_TA02','_GCircleM2P');"/>
				<select id="_GCircleM2P" style="border:1px solid #505050;" onclick="subM2P_GCircle('_GCircleM2P','_TA02')"><option value="0">範囲円なし</option><option value="50">50m</option><option value="100">100m</option><option value="250">250m</option><option value="500">500m</option><option value="1000">1km</option><option value="2000">2km</option><option value="4000">4km</option><option value="8000">8km</option><option value="20000">20km</option><option value="25000">25km</option><option value="40000">40km</option><option value="100000">100km</option><option value="500000">500km</option><option value="1000000">1000km</option><option value="2000000">2000km</option><option value="5000000">5000km</option></select>
			</div>
		</div>
	</div>
	<div id="_divMap">
		<script>
		// 地図描写調整
		subInitDisp();

		// _divNaviCommander 初期座標＠皇居
		with(document){
			getElementById("_NaviLat").value  = (35.68518697509636).toFixed(8);
			getElementById("_NaviLng").value  = (139.7522735595703).toFixed(8);
			getElementById("_NaviZoom").value = 5;
		}
		// URLからXYZ値を取得
		var hash = window.location.hash;
		if(hash == ""){
			// URL／BL表示を変更
			_iwmCU();
		}
		else{
			var aHash = hash.split("/");
			with(document){
				getElementById("_NaviZoom").value = aHash[0].substr(1); // 先頭の'#'より後
				getElementById("_NaviLat").value  = parseFloat(aHash[1]).toFixed(8);
				getElementById("_NaviLng").value  = parseFloat(aHash[2]).toFixed(8);
			}
		}

		// 【おまじない】複数のポップアップを許可（1.x対応）
		L.Map = L.Map.include({
			openPopup: function (popup, latlng, options) {
				if (latlng) {
					popup.setLatLng(latlng);
				}
				if (this._popup && this._popup.options.autoClose) {
					///this.closePopup();
				}
				this._popup = popup;
				return this.addLayer(popup);
			}
		});
	
		// 初回表示設定
		var $Map = L.map(
			"_divMap",
			{
				center: [
					document.getElementById("_NaviLat").value,
					document.getElementById("_NaviLng").value
				],
				zoom: document.getElementById("_NaviZoom").value,
				minZoom: 3,  // 最小ズーム
				maxZoom: 23, // 最大ズーム
				zoomControl: false, // Control.Zoom 非表示
				doubleClickZoom: false // DblClick制御
			}
		);

		/*---------------
		// スケール表示
		---------------*/
		L.control.scale({
			metric: true,
			imperial: false,
			position: "bottomleft"
		}).addTo($Map);

		/*-----------
		// 距離測定
		-----------*/
		L.control.polylineMeasure({
			position: "bottomleft",
			unit: "metres",
			showBearings: false,
			clearMeasurementsOnStop: false,
			showClearControl: true,
			showUnitControl: false
		}).addTo($Map);

		/*-------------------------
		// ベクトルタイル提供実験
		-------------------------*/
		/* 0.7x 対応（1.x 未対応）
			var xhr = new XMLHttpRequest();
				xhr.open(
					"GET",
					"https://cyberjapandata.gsi.go.jp/xyz/experimental_fgd/style.js",
					false
				);
			xhr.overrideMimeType("text/javascript");
			xhr.send(null);
			var stylejs = eval( "(" + xhr.responseText + ")" );
			var $fgdLayer = new L.TileLayer.GeoJSON(
				"https://cyberjapandata.gsi.go.jp/xyz/experimental_fgd/{z}/{x}/{y}.geojson",
				stylejs.options,
				stylejs.geojsonOptions
			);
		*/

		/*------------------------
		// 標準地図等を色調変換
		------------------------*/
		/*【参考】
			http://sterfield.co.jp/designer/canvas%E3%81%A7%E7%94%BB%E5%83%8F%E3%81%AE%E7%99%BD%E3%82%92%E9%80%8F%E9%81%8E%E3%81%AB%E3%81%99%E3%82%8B/
		*/
		// 標準 => 明色
		var $stdTransBright = new L.GridLayer();
		$stdTransBright.createTile = function(coords){
			var canvas = L.DomUtil.create("canvas", "leaflet-tile");
				canvas.width = canvas.height = 256;
			var ctx = canvas.getContext("2d");
			var img = new Image();
			img.crossOrigin = "anonymous";
			// leafletが使うタイルと別のサーバ（https／http）にアクセスし、Access-Control-Allow-Originを回避
			img.src = "http://cyberjapandata.gsi.go.jp/xyz/std/" + coords.z + "/" + coords.x + "/" + coords.y + ".png";
			img.onload = function(){
				ctx.drawImage(this, 0, 0);
				var rtnImg = ctx.getImageData(0, 0, 256, 256);
				var rtnImgData = rtnImg.data;
				// 透過画像を作成
				for(var i = 0; i < rtnImgData.length; i+=4){
					if(rtnImgData[i + 0] > 180 && rtnImgData[i + 1] > 180 && rtnImgData[i + 2] > 180){
						rtnImgData[i + 3] = 0;
					}
					else{
						rtnImgData[i + 3] = 255;
						rtnImgData[i + 0] *= 1.1;
						rtnImgData[i + 1] *= 1.1;
						rtnImgData[i + 2] *= 1.1;
					}
				}
				ctx.putImageData(rtnImg, 0, 0);
				ctx = null;
			}
			return canvas;
		}

		// 標準 => 褐色
		var $stdTransBrown = new L.GridLayer();
		$stdTransBrown.createTile = function(coords){
			var canvas = L.DomUtil.create("canvas", "leaflet-tile");
				canvas.width = canvas.height = 256;
			var ctx = canvas.getContext("2d");
			var img = new Image();
			img.crossOrigin = "anonymous";
			// leafletが使うタイルと別のサーバ（https／http）にアクセスし、Access-Control-Allow-Originを回避
			img.src = "http://cyberjapandata.gsi.go.jp/xyz/std/" + coords.z + "/" + coords.x + "/" + coords.y + ".png";
			img.onload = function(){
				ctx.drawImage(this, 0, 0);
				var rtnImg = ctx.getImageData(0, 0, 256, 256);
				var rtnImgData = rtnImg.data;
				// 透過画像を作成
				for(var i = 0; i < rtnImgData.length; i+=4){
					// 各カラーチャンネルで、一番暗い値を取得
					var minLuminance = rtnImgData[i];
					if(minLuminance > rtnImgData[i + 1]){
						minLuminance = rtnImgData[i + 1];
					}
					if(minLuminance > rtnImgData[i + 2]){
						minLuminance = rtnImgData[i + 2];
					}
					// 減色
					rtnImgData[i + 0] -= minLuminance;
					rtnImgData[i + 1] -= minLuminance;
					rtnImgData[i + 2] -= minLuminance;
					// 一番暗い値をアルファチャンネルに反映(明るいところほど透明に)
					rtnImgData[i + 3] = 255 - minLuminance;
				}
				ctx.putImageData(rtnImg, 0, 0);
				ctx = null;
			}
			return canvas;
		}

		/*---------------------
		// タイルの外郭を表示
		---------------------*/
		var $tileCoord = new L.GridLayer();
		$tileCoord.createTile = function(coords){
			var canvas = L.DomUtil.create("canvas", "leaflet-tile");
				canvas.width = canvas.height = 256;
			var tileText = coords.z + "-" + coords.x + "-" + coords.y;
			var ctx = canvas.getContext("2d");
				// 枠線
				ctx.lineWidth = 1;
				ctx.strokeStyle = "#000";
				ctx.strokeRect(0, 0, 255, 255);
				// 文字
				ctx.font = "24px Arial";
				ctx.textAlign = "center";
				ctx.lineWidth = 6.0;
				ctx.strokeStyle = "#fff";
				ctx.strokeText(tileText, 128, 128);
				// 文字ヌキ
				ctx.fillStyle = "#88f";
				ctx.fillText(tileText, 128, 128);
				ctx = null;
			return canvas;
		};

		/*--------------------------------------------------------------------------------------
		// メニュー等で使用
		//   [0]'地図種', [1]'URL', [2]'拡張子', [3]'opacity', [4]'maxNativeZoom'
		//   (例) ["std", "https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png", 1.0, 18]
		// http://maps.gsi.go.jp/development/ichiran.html
		--------------------------------------------------------------------------------------*/
		var $URL = "https://cyberjapandata.gsi.go.jp/xyz/";

		/*---------------
		// ラジオボタン
		---------------*/
		var $radioButtonSelectMap = [];

		var $radioButtonMap = [];
			$radioButtonMap.push(["標準", $URL + "std/{z}/{x}/{y}.png", 1.0, 18]);
			$radioButtonMap.push(["淡色", $URL + "pale/{z}/{x}/{y}.png", 1.0, 18]);
			$radioButtonMap.push(["白色", $URL + "blank/{z}/{x}/{y}.png", 1.0, 18]);
			$radioButtonMap.push(["なし", "", 0.0, 18]);

		var a1 = [];

		var i1 = 0;
		var i2 = $radioButtonMap.length;
		for(; i1 < i2; i1++){
			a1 = $radioButtonMap[i1];
			$radioButtonSelectMap[a1[0]] = L.tileLayer(
				a1[1],
				{
					///attribution: a1[0],
					attribution: "地理院地図",
					opacity: a1[2],
					maxNativeZoom: a1[3],
					maxZoom: 23
				}
			);
			a1 = null;
		}
		// 初期選択値
		$radioButtonSelectMap[$radioButtonMap[0][0]].addTo($Map);

		/*-----------------------
		// チェックボックス可変
		-----------------------*/
		$LMapSelector = null;
		function subMapSelector(){
			var $checkBoxSelectMap = [];

			if(document.getElementById("_TA01").value == ""){
				document.getElementById("_TA01").value = "# タイル種\t拡張子\t透過率(0.n-1.0)\t最大ズーム\n# [Tab]区切り\nseamlessphoto\tjpg\t1.0\t18\nrelief\tpng\t0.5\t15\n";
			}

			var a1 = document.getElementById("_TA01").value.split("\n");
			var a2 = [];
			var a3 = [];

			var i1 = 0;
			var i2 = a1.length;
			for(; i1 < i2; i1++){
				var s1 = a1[i1].trim().substring(0, 1);
				if(s1 != "" && s1 != "#"){
					a3 = a1[i1].split("\t");

					a3[0] = a3[0].trim();

					try{
						a3[1] = a3[1].trim();
					}
					catch(e){
						a3[1] = "png";
					}

					try{
						a3[2] = parseFloat(a3[2]);
					}
					catch(e){
						a3[2] = 0.5;
					}

					try{
						a3[3] = parseInt(a3[3]);
					}
					catch(e){
						a3[3] = 18;
					}

					a2.push([a3[0], $URL + a3[0] + "/{z}/{x}/{y}." + a3[1], a3[2], a3[3]]);

					a3 = null;
				}
			}
			a2.push(["シームレス地質図", "https://gbank.gsj.jp/seamless/v2/api/1.2/tiles/{z}/{y}/{x}.png", 0.5, 13]);

			a1 = null;

			var i1 = 0;
			var i2 = a2.length;
			for(; i1 < i2; i1++){
				a3 = a2[i1];
				$checkBoxSelectMap[a3[0]] = L.tileLayer(
					a3[1],
					{
						attribution: a3[0],
						opacity: a3[2],
						maxNativeZoom: a3[3],
						maxZoom: 23
					}
				);
				a3 = null;
			}
			a2 = null;

			///$checkBoxSelectMap["ベクトルタイル提供実験（Zoom18のみ）"] = $fgdLayer;
			$checkBoxSelectMap["注記（明色）"] = $stdTransBright;
			$checkBoxSelectMap["注記（褐色）"] = $stdTransBrown;
			$checkBoxSelectMap["タイル座標"] = $tileCoord;

			/*-------------------
			// 地図選択メニュー
			-------------------*/
			if($LMapSelector){
				$Map.removeControl($LMapSelector); // 前出を削除
			}
			$LMapSelector = L.control.layers(
				$radioButtonSelectMap,
				$checkBoxSelectMap,
				{
					position: "topright"
				}
			);
			$LMapSelector.addTo($Map);

			// $checkBoxSelectMap のチェックが Off のとき
			$Map.on(
				"overlayremove",
				function legendRemove(e){
					try{
						$Map.removeLayer($checkBoxSelectMap[e.name]);
						// 履歴すべてを非表示にする
						for(key in $checkBoxSelectMap){
							///console.log(key);
							$Map.removeLayer($checkBoxSelectMap[key]);
						}
					}
					catch(e){
					}
				}
			);
		}
		subMapSelector();

		// 座標マーカー
		var $BaseMarkerIcon = L.AwesomeMarkers.icon(
			{
				icon: "home",
				prefix: "fa",
				markerColor: "darkblue",
				spin: false
			}
		);
		var $LocalMarkerDragOn = L.AwesomeMarkers.icon(
			{
				icon: "flag",
				prefix: "fa",
				markerColor: "darkred",
				spin: false
			}
		);
		var $LocalMarkerDragOff = L.AwesomeMarkers.icon(
			{
				icon: "thumb-tack",
				prefix: "fa",
				markerColor: "orange",
				spin: false
			}
		);
		/*---------------
		// センタリング
		---------------*/
		function subCenterMap(
			$Lat,
			$Lng
		){
			if(isNaN($Lat)){
				$Lat = document.getElementById($Lat).value;
			}
			if(isNaN($Lng)){
				$Lng = document.getElementById($Lng).value;
			}
			$Map.setView(
				[
					$Lat,
					$Lng
				],
				// 必ず "_NaviZoom" で呼ぶ
				document.getElementById("_NaviZoom").value
			);
		}
		function subCenterMap2(){
			$Map.setView(
				$Map.getCenter(),
				// 必ず "_NaviZoom" で呼ぶ
				document.getElementById("_NaviZoom").value
			);
		}
		/*-----------------------------
		// マーカーのポップアップ更新
		-----------------------------*/
		function subMarkerPopup(
			$BaseMarker,
			$AryLocalMarker
		){
			// ベースマーカー
			$BaseMarker.closePopup();

			subLngLatToPlaceName(
				$BaseMarker._latlng.lat,
				$BaseMarker._latlng.lng,
				$BaseMarker,
				null
			);

			$BaseMarker.bindPopup(
				subMarkerPopup1(
					$BaseMarker._latlng.lat,
					$BaseMarker._latlng.lng
				),
				{
					autoPan: false // ポップアップ時、表示調整しない
				}
			);
			$BaseMarker.openPopup();

			// ローカルマーカー
			for(i1 = 0, len = $AryLocalMarker.length; i1 < len; i1++){
				$AryLocalMarker[i1].closePopup();
				var LM = $AryLocalMarker[i1];
				LM.bindPopup(
					subMarkerPopup2(
						$BaseMarker._latlng.lat,
						$BaseMarker._latlng.lng,
						LM._latlng.lat,
						LM._latlng.lng,
						LM
					),
					{
						autoPan: false // ポップアップ時、表示調整しない
					}
				);
				LM.openPopup();
			}
		}
		/*---------------------
		// ベースマーカー描画
		---------------------*/
		var $BaseMarker = null;
		var $AryLocalMarker = [];

		function subBaseMarkerNew(
			$Lat,
			$Lng
		){
			var i1 = 0;
			var i2 = arguments.length;
			for(; i1 < i2 ;i1++){
				if(isNaN(arguments[i1])){
					arguments[i1] = document.getElementById(arguments[i1]).value;
				}
			}
			if($BaseMarker){
				$Map.removeLayer($BaseMarker);
			}
			$BaseMarker = L.marker(
				[
					$Lat,
					$Lng
				],
				{
					icon: $BaseMarkerIcon,
					draggable: true // ドラッグ許可
				}
			).addTo($Map);

			$BaseMarker.elevation = "---";

			// URL／BL表示を変更
			subChangeUrl(
				$Lat,
				$Lng,
				"_NaviZoom"
			);

			// ポップアップ非表示
			function subMarkerClosePopup(){
				///$BaseMarker.closePopup();
				var i1 = 0;
				var i2 = $AryLocalMarker.length;
				for(; i1 < i2; i1++){
					$AryLocalMarker[i1].closePopup();
				}
			}

			// ズームレベル変更 <= click
			$BaseMarker.on(
				"click",
				function(e){
					// ズームレベル補完
					var mouseP = $Map.latLngToContainerPoint(this.getLatLng());
					subIwmInputZoomA_open(
						"_NaviZoom",
						(mouseP.x + 30),
						(mouseP.y - 40)
					);
				}
			);
			// 全ポップアップ表示 <= contextmenu
			$BaseMarker.on(
				"contextmenu",
				function(e){
					this.closePopup();
					subMarkerPopup(
						$BaseMarker,
						$AryLocalMarker
					);
					var i1 = $AryPoint.length;
					while(i1--){
						$AryPoint[i1].openPopup();
					}
				}
			);
			// ポップアップ情報更新 <= dragend
			$BaseMarker.on(
				"dragend",
				function(e){
					// URL／BL表示を変更
					var a1 = this.getLatLng();
					subChangeUrl(
						a1.lat,
						a1.lng,
						"_NaviZoom"
					);
					// "_InputBL" を更新
					_iwmIBL($IwmInputBL_saveId);

					// 表示を更新して、すぐに隠す
					subMarkerPopup(
						$BaseMarker,
						$AryLocalMarker
					);
					this.closePopup();
				}
			);
			// 何もしない <= mouseover
			$BaseMarker.on(
				"mouseover",
				function(e){
					// 先読みしておく
					subMarkerPopup1(
						$BaseMarker._latlng.lat,
						$BaseMarker._latlng.lng
					);
				}
			);
			// ポップアップ非表示 <= mouseout
			$BaseMarker.on(
				"mouseout",
				function(e){
					///subMarkerClosePopup();
				}
			);
		}

		// ベースマーカー初回描画
		_iwmBMN();

		// ズームバー
		subIwmInputZoom_change($Map.getZoom());

		// ミニマップ
		var miniMapLayer = new L.TileLayer(
			"https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png",
			{
				minZoom: 3,
				maxZoom: 18
			}
		);
		new L.Control.MiniMap(
			miniMapLayer,
			{
				toggleDisplay: true
			}
		).addTo($Map);

		/*-----------------
		// 右クリック共通
		-----------------*/
		function subMapOnRClick(
			$lat,
			$lng,
			$placeName
		){
			var bIconDrag = false;
			if(!$placeName){
				bIconDrag = true;
			}

			// マーカー作成
			$AryLocalMarker.push(
				L.marker(
					[
						$lat,
						$lng
					],
					{
						icon: (bIconDrag ? $LocalMarkerDragOn : $LocalMarkerDragOff),
						draggable: bIconDrag
					}
				).addTo($Map)
			);

			$AryLocalMarker[$AryLocalMarker.length - 1].elevation = "---";

			// [マーカー削除]ボタン表示
			subMyObj_onOff($AryLocalMarker);

			// 現在(配列)のローカルマーカー
			var obj = $AryLocalMarker[$AryLocalMarker.length - 1];

			// 緯度経度から地名を検索
			subLngLatToPlaceName(
				$lat,
				$lng,
				obj,
				(bIconDrag ? null : ("★" + $placeName))
			);

			// 固定点地名のときだけセンタリング
			if(!bIconDrag){
				subCenterMap(
					$lat,
					$lng
				);
			}

			// ズームレベル補完 <= click
			obj.on(
				"click",
				function(e){
					// ズームレベル補完
					$HashLatLng = this.getLatLng();
					var mouseP = $Map.latLngToContainerPoint($HashLatLng);
					subIwmInputZoomA_open(
						"_NaviZoom",
						(mouseP.x + 20),
						(mouseP.y - 25)
					);
				}
			);
			// マーカー削除 <= contextmenu
			obj.on(
				"contextmenu",
				function(e){
					for(i1 = 0, len = $AryLocalMarker.length; i1 < len; i1++){
						if(this == $AryLocalMarker[i1]){
							// マーカー削除
							$Map.removeLayer($AryLocalMarker[i1]);
							// 配列から削除
							$AryLocalMarker.splice(i1, 1);
							break;
						}
					}
					// [マーカー削除]ボタン非表示
					subMyObj_onOff($AryLocalMarker);
				}
			);
			// ドラッグ <= dragend
			obj.on(
				"dragend",
				function(e){
					// 先読みしておく
					subMarkerPopup2(
						$BaseMarker._latlng.lat,
						$BaseMarker._latlng.lng,
						this._latlng.lat,
						this._latlng.lng,
						this
					);
				}
			);
			// ポップアップ表示更新 <= mouseover
			obj.on(
				"mouseover",
				function(e){
					// 先読みしておく
					subMarkerPopup2(
						$BaseMarker._latlng.lat,
						$BaseMarker._latlng.lng,
						this._latlng.lat,
						this._latlng.lng,
						this
					);
				}
			);
			// ポップアップ再表示 <= mouseout
			obj.on(
				"mouseout",
				function(e){
					this.closePopup();
					this.bindPopup(
						subMarkerPopup2(
							$BaseMarker._latlng.lat,
							$BaseMarker._latlng.lng,
							this._latlng.lat,
							this._latlng.lng,
							this
						),
						{
							autoPan: false // ポップアップ時、表示調整しない
						}
					);
					this.openPopup();
				}
			);
			obj = null;
		}

		/*---------------------
		// 地図上イベント共通
		---------------------*/
		// マーカー毎のイベント設定後でないと不具合
		$Map.on(
			"dblclick",
			function(e){
				// ズームレベル補完
				subIwmInputZoomA_open(
					"_NaviZoom",
					(e.containerPoint.x + 20),
					(e.containerPoint.y - 25)
				);
				// ベースマーカー再描画
				subBaseMarkerNew(
					e.latlng.lat,
					e.latlng.lng
				);
				// 距離円再描画
				subGCircleInit();
			}
		);
		$Map.on(
			"contextmenu",
			function(e){
				subMapOnRClick(
					e.latlng.lat,
					e.latlng.lng,
					null
				);
			}
		);
		$Map.on(
			"zoomend",
			function(e){
				// URL／BL表示を変更
				subChangeUrl(
					"_NaviLat",
					"_NaviLng",
					$Map.getZoom()
				);
				// ズームバー
				subIwmInputZoom_change($Map.getZoom());
			}
		);
		</script>
	</div>
</body>

</html>

<!---------------------
// ヒアドキュメント風
---------------------->
<textarea id="_HDoc01" style="display:none;">
<style>
._fs1{color:#f00;}
._fs2{color:#00f;}
._ol, ._ul{margin:0;padding:0;}
._li1, ._li2{padding:1px;}
._li1{margin:0 0 0 32px;}
._li2{margin:0 0 0 0;}
._ol ._li1{padding:6px 0 0 0;}
</style>
<span class="_fs1">【地図上でのマウス操作】</span>
 <ul class="_ul">
  <li class="_li1">ダブルクリック：青マーカー移動</li>
  <li class="_li1">左クリック：全ポップアップ非表示</li>
  <li class="_li1">右クリック：赤マーカー追加</li>
 </ul>
<br>
<span class="_fs2">【マーカー上でのマウス操作】</span>
 <ol class="_ol">
  <li class="_li1">青マーカー
   <ul class="_ul">
    <li class="_li2">左クリック：ズームレベル</li>
    <li class="_li2">右クリック：全ポップアップ</li>
    <li class="_li2">ドラッグ：移動</li>
    <li class="_li2">マウスオーバー：何もしない</li>
   </ul>
  </li>
  <li class="_li1">赤マーカー
   <ul class="_ul">
    <li class="_li2">左クリック：ズームレベル</li>
    <li class="_li2">右クリック：消去</li>
    <li class="_li2">ドラッグ：移動</li>
    <li class="_li2">マウスオーバー：ポップアップ</li>
   </ul>
  </li>
  <li class="_li1">オレンジマーカー
   <ul class="_ul">
    <li class="_li2">左クリック：ズームレベル</li>
    <li class="_li2">右クリック：消去</li>
    <li class="_li2">ドラッグ：何もしない</li>
    <li class="_li2">マウスオーバー：ポップアップ</li>
   </ul>
  </li>
 </ol>
</li>
</textarea>
